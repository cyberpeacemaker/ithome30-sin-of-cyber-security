# 【20】資安的原罪 ch.3-3.b 加密與憑證簽章

   * **Objective**: Start with the importance of **security** and **trust** in digital communication.
   * Discuss the problem of **untrusted networks** and the need for encryption and authentication.

---

### 什麼是加密？

加密是一種將資料轉換為**編碼形式**（密文）的過程，目的是防止未經授權的存取。這個概念是為了確保即使資料被攔截，沒有正確的解密金鑰也無法閱讀或使用這些資料。
### Use Cases:

* **Secure Communications**: Ensuring that messages or calls can't be intercepted and read by unauthorized parties.
* **Data Protection**: Protecting sensitive data like passwords, credit card details, or files stored on devices or servers.
* **Authentication**: Using encryption in protocols like SSL/TLS (for HTTPS) to verify identities.
* 隨身碟 硬碟加密

### 核心概念：

1. **明文（Plaintext）**：原始的、可讀的資料（例如訊息、檔案）。
2. **密文（Ciphertext）**：加密後的明文，看起來像隨機資料，沒有解密是無法閱讀的。
3. **金鑰（Key）**：一段資訊（通常是字元串或數字），由加密演算法使用來進行加密與解密。加密的安全性主要取決於金鑰的保密性。
4. **演算法（Algorithm）**：定義加密與解密過程的數學程序。一些常見的演算法包括：

   * **AES（先進加密標準）** – 廣泛用於資料加密。
   * **RSA** – 常用於安全通訊中的金鑰交換。
   * **ECC（橢圓曲線加密技術）** – 因為效率高，特別適用於資源有限的小型裝置，正越來越受到歡迎。

### 加密的類型：

1. **對稱式加密（Symmetric Encryption）**：加密與解密使用相同的金鑰。

   * 範例：AES。
   * **優點**：速度快。
   * **缺點**：金鑰傳輸是一大挑戰——如果金鑰被攔截，資料就會被破解。

2. **非對稱式加密（Asymmetric Encryption）**：使用一對金鑰：**公開金鑰**（用來加密資料）與**私密金鑰**（用來解密資料）。

   * 範例：RSA。
   * **優點**：用於金鑰交換更安全，因為私密金鑰不會被傳輸。
   * **缺點**：比對稱加密慢。
TODO: 進階加密?

## 數位簽章

## 🔐 什麼是數位簽章？

數位簽章是一種**驗證數位訊息或文件真實性與完整性**的技術。它就像是電子世界的「手寫簽名」或「蓋章」，可以用來確認：

1. **訊息來自誰**（身份驗證）
2. **訊息未被竄改**（完整性）
3. **傳送者不能否認**曾經簽署這份訊息（不可否認性）

## ✨ 數位簽章的工作原理（基本流程）

它通常與**非對稱加密技術**（如 RSA 或 ECC）搭配使用，步驟如下：

### ✅ 簽署階段（Sender → Signer）：

1. 發送者先將要傳送的原始資料進行雜湊（Hash）處理，產生一個固定長度的雜湊值（例如用 SHA-256）。
2. 然後用自己的**私密金鑰**對這個雜湊值進行加密，產生數位簽章。
3. 發送者將**原始資料**與**數位簽章**一併發送給接收者。

### 🔎 驗證階段（Receiver → Verifier）：

1. 接收者用發送者的**公開金鑰**對簽章進行解密，得到一個雜湊值A。
2. 同時接收者也對收到的原始資料做相同的雜湊，得到雜湊值B。
3. 如果 **A 和 B 相同**，就表示資料**未被竄改且確實來自發送者**。

## 🧩 數位簽章 vs 加密

| 項目   | 數位簽章           | 加密        |
| ---- | -------------- | --------- |
| 目標   | 驗證身份、完整性與不可否認性 | 保密資料內容    |
| 使用金鑰 | 私鑰簽名、公鑰驗證      | 公鑰加密、私鑰解密 |
| 保護對象 | 資料的真實性與來源      | 資料的機密性    |

---


TODO:
## SSL協定
通訊加密
部屬超文本傳輸協定 HTTPS
HTTP TLS 類似結果 [連結](https://www.usenix.org/conference/usenixsecurity17/technical-sessions/presentation/krombholz)


---

## 🧾 什麼是「憑證」？

**憑證（Certificate）**是一份**數位身分證明**，用來**證明一個公鑰的擁有者是誰**。它通常由**憑證授權單位（CA, Certificate Authority）**簽發，內容包含一個公開金鑰以及與該金鑰相關的身分資訊。

它的正式名稱是 **X.509 憑證**，這是一個國際標準，用於網路上的安全通訊。

TODO:
> **憑證的本質就是「用來驗證公鑰身分」的數位身分證**，在現代網路安全體系中，它是建立「信任」的基石。

## 🔐 憑證的主要內容

一個典型的 X.509 數位憑證會包含以下資訊：

| 項目             | 說明                        |
| -------------- | ------------------------- |
| **Subject**    | 憑證持有者的身分資訊（例如網站名稱、公司名）    |
| **Public Key** | 與此身分綁定的公開金鑰               |
| **Issuer**     | 簽發此憑證的憑證授權單位（CA）          |
| **Signature**  | CA 對這份憑證內容做出的數位簽章         |
| **有效期限**       | 憑證的有效起始與截止日期              |
| **序號**         | 憑證的唯一識別碼                  |
| **演算法資訊**      | 用於簽章的加密演算法（例如 SHA256-RSA） |

---

## 🌐 為什麼需要憑證？

想像你正在連線到一個網站（例如：[https://example.com）時，你會想確認兩件事：](https://example.com）時，你會想確認兩件事：)

1. **這個網站真的是 example.com 本人嗎？**
2. **它的公開金鑰是真的，沒被假冒或竄改嗎？**

憑證就是為了解決這個問題，它的角色是：

* 保證公鑰的真實性
* 提供公開金鑰與真實身分之間的**信任連結**
* 阻止中間人攻擊（MITM）

---

## 🏢 憑證授權單位（CA）是誰？

CA 是負責**核發與簽署憑證**的權威單位，比如：

* Let's Encrypt（免費）
* DigiCert
* GlobalSign
* Sectigo（Comodo）
* Google Trust Services

他們會驗證請求者的身分（可能是個人、公司或網站），然後對其公開金鑰做出**數位簽章**，生成一張有效的憑證。
## 🔑 什麼是 CA（憑證授權單位）？

CA 就像「數位身分證發證機關」，負責：

* **核實申請者身份**：確認網站或組織是真實存在的，且擁有申請的域名或身分。
* **簽發數位憑證**：給申請者一張由 CA 簽名的憑證，證明其公開金鑰和身份綁定有效。
* **管理憑證的有效性**：包括憑證的撤銷與更新。
憑證機構必須具備優良的聲譽 他們簽發的安全性憑證才會得到信

## 🧭 信任鏈（Certificate Chain）與根憑證

憑證的驗證是靠**信任鏈（Chain of Trust）**來建立的：

1. 你收到一張網站憑證（由某 CA 簽發）
2. 你的瀏覽器會查看這個 CA 是否被信任
3. 如果 CA 是由更上層的「中繼 CA」簽署的，會繼續往上查
4. 最終要找到一個「**根憑證（Root Certificate）**」，是你系統/瀏覽器**內建信任**的

## ✅ 實際應用場景

| 應用       | 描述                      |
| -------- | ----------------------- |
| HTTPS    | 網站憑證驗證與加密通訊             |
| 電子郵件簽章   | 驗證寄件人與內容完整性             |
| 軟體簽章     | 保證安裝檔未被篡改（如 Windows 軟體） |
| VPN 憑證驗證 | 保障使用者與伺服器之間的安全連線        |

## 🚨 常見憑證錯誤（你可能見過）

* ❌「您的連線不是私人連線」（證書過期、無效或自簽）
* ⚠️「憑證不受信任的頒發者簽發」
* 🕒「憑證尚未生效或已過期」

這些通常是因為憑證問題導致 HTTPS 安全性遭到破壞。

---

## 🏗️ 什麼是 PKI（公開金鑰基礎建設）？

PKI 是一整套**政策、流程、技術與系統的集合**，用來管理：

* 公開金鑰與私密金鑰的產生和管理
* 憑證的申請、簽發、驗證、撤銷
* 信任鏈的建立與維護（包括根憑證、中繼憑證）
* 整個公開金鑰生態系統的安全與運作

簡單來說，PKI 是一個**信任生態系統**，CA 是這個系統中最重要的「信任樞紐」。
網路身分驗證的信任錨點(trust anchor) 網路上層層信任的起點 

## 🌐 CA 與 PKI 的關係

* **CA 是 PKI 的核心組成部分**，負責發行和管理憑證。
* **PKI 則是更大的架構**，包含多個 CA、憑證資料庫、撤銷清單（CRL）、信任政策等等。
* 透過 PKI，使用者和系統能夠在網路上安全交換資訊，確保身份與資料的完整性。

## 📌 簡單比喻

想像 PKI 是一個「國家發行身分證的制度與流程」，
而 CA 就是政府的「發證機關」，
他們一起確保每張身分證（憑證）的真實與有效。

---

## 原罪

### 加密法過時 
DES 
量子 雲端 運算

### 加密外弱點
其他弱點的存在，讓加密失去意義 || 密碼被破解、繞過、中間人、供應鏈、後門
金鑰外洩

SSL協定 讓瀏覽器與網頁伺服器間的通訊可以加密 但若瀏覽器與網頁伺服器存在安全弱點 那這個協定意義也不大

### 失效憑證
使用者到管理員，面對憑證警告，只會選擇忽視
**長期**
若企業能全面淘汰固定使用的長期憑證，並改用臨時存取機制，將能大幅降低被濫用的機率。[^2]
**偽造 偷取**
EX: 荷蘭 憑證簽發機構difinotar 駭客入侵 偽造500數位憑證 一周內 diginotar宣告破產
stunxnext 使用從台灣偷來的兩張憑證
TA-ShadowCricket偽造或盜用數家軟體廠商憑證簽署惡意軟體的現象，其中一家是臺灣軟體業者訊連科技（CyberLink），駭客於2012年曾偽造該公司憑證為惡意軟體簽章[^3]

Adversaries may obtain and abuse credentials of existing accounts as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion. Compromised credentials may be used to bypass access controls placed on various resources on systems within the network and may even be used for persistent access to remote systems and externally available services, such as VPNs, Outlook Web Access, network devices, and remote desktop.


### 不合規CA

其憑證被撤除信任的原因為，其團隊沒有即時掌握落實的調整，例如2023年9月15日生效的BR，要求修改延伸用途欄位EKU的標註內容，因其團隊沒有即時掌握和執行，致使部分憑證的格式EKU不符規定，其他疏失還有包括機關代號、地址欄位的編碼不符規定等。
此外，中華電信團隊先前以窒礙難行為由，沒有即時向上通報，快速處理，例如依規定，對於Bugzilla論壇上社群的詢問，CA業者需在72小時內回應，但中華電信以和憑證客戶的合約，需得到客戶的審查才能回應論壇提問，致使無法來得及在72小時內回應，過慢的回應引發論壇上的不滿。
其次是，CA業者依規定需定期提交合規文件，但是中華電信以團隊正值更替、交接不完整，致使承接的團隊沒能在規定時限內提交。
上述2024年中華電信憑證團隊的不合規事件[^1]


---


### 金鑰基礎建設
PKI部屬的任務窒礙難行，過程牽涉到38個獨立步驟，每個步驟對執行者來說都代表一個決定 [連結](https://faculty.cc.gatech.edu/~beki/j7.pdf)


[^1]: https://www.ithome.com.tw/news/169597
[^2]: https://www.ithome.com.tw/news/169608
[^3]: https://www.ithome.com.tw/news/169197