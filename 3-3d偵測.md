# 【22】資安的原罪 ch.3-3.d 監控、偵測與回應

本章見證現代進階的防禦、偵測和應對技術。

---

## 什麼是 IDS、IPS、IDPS？

隨著網路威脅的持續演變，僅依賴傳統的防火牆與防毒軟體已不足以全面防禦各種資安攻擊。防火牆雖然可以過濾不合法的網路連線，防毒軟體也能偵測和清除已知的惡意程式，但它們往往無法即時識別出針對系統漏洞、異常行為或內部威脅的入侵行為。因此，我們需要更進階的安全機制來補足這些不足之處——這就是 IDS、IPS 和 IDPS 的主要任務。

### IDS（入侵偵測系統）

**IDS**（Intrusion Detection System，入侵偵測系統）負責**監控網路流量或主機活動**，藉由比對攻擊特徵或行為模式來偵測可疑行為或潛在的入侵事件。當發現異常時，IDS 會**發出警示**通知管理員，但**不會主動阻擋攻擊**。因此，它是一種被動式防禦工具，重點在於「偵測」。

#### IDS 的類型：

1. **NIDS（網路入侵偵測系統）**：

   * 監控網路層的流量，偵測攻擊行為或政策違規事件。
   * 可辨識如 DDoS 攻擊、連接埠掃描、惡意軟體通信等異常流量。
   * 例子：**NIDS** 可能會發現某個 IP 地址傳送異常大量流量，疑似發動 DDoS 攻擊。

2. **HIDS（主機入侵偵測系統）**：

   * 監控個別主機（如伺服器或桌面電腦）的系統活動。
   * 可偵測檔案被非法修改、權限異動或惡意軟體行為。
   * 例子：**HIDS** 會警示伺服器系統檔案被未經授權的修改企圖。

3. **PIDS（通訊協定入侵偵測系統）**：

   * 部署於伺服器前端，監控進出裝置的通訊協定流量，確保協定遵從性。

4. **APIDS（應用程式通訊協定入侵偵測系統）**：

   * 監控一組伺服器間的應用層協定流量，針對應用層的攻擊進行偵測。

5. **混合式 IDS**：

   * 結合多種 IDS 類型，提供更全面的入侵偵測功能。


### IPS（入侵防禦系統）

**IPS**（Intrusion Prevention System，入侵防禦系統）不僅能偵測異常行為，還能**主動攔截或阻擋可疑的流量或行為**，如封鎖惡意 IP、終止連線或丟棄封包等。這讓 IPS 成為一個具備主動防禦能力的安全設備。

#### IPS 的類型：

1. **NIPS（網路入侵防護系統）**：

   * 監控並保護整個網路流量，阻止網路層的攻擊。

2. **WIPS（無線入侵防護系統）**：

   * 專門監控企業內部的無線網路，防範無線網路相關威脅。

3. **HIPS（主機入侵防護系統）**：

   * 部署於關鍵主機或裝置，監控並防範主機層級的攻擊。

4. **NBA（網路行為分析）**：

   * 根據網路流量模式分析異常行為，輔助偵測和防禦複雜攻擊。

### IDPS 是什麼？

IDPS 入侵偵測與防禦系統（Intrusion Detection and Prevention System 整合 IDS 和 IPS 功能的系統，**兼具偵測與防禦**的能力，能即時識別各種入侵行為並採取相應的防禦措施。這種系統常被部署在關鍵節點，用來全面監控網路活動、減少資安風險。

---

## WAF 是什麼？

**WAF（網頁應用防火牆，Web Application Firewall）** 是一種專門用來保護網站與網頁應用程式安全的防火牆。它主要運作於應用層（第七層），能夠監控、過濾並阻擋惡意的 HTTP/HTTPS 流量，有效防止駭客針對網站弱點所發動的攻擊。，例如：

* SQL注入（SQL Injection）
* 跨站腳本攻擊（XSS）
* 跨站請求偽造（CSRF）
* 文件包含攻擊等

---

## UTM 是什麼？

**UTM（統合威脅管理，Unified Threat Management）** 是一種將多種網路安全功能整合在同一設備中的安全解決方案。它通常結合了防火牆、入侵偵測與防禦（IDS/IPS）、防毒、垃圾郵件過濾、內容過濾、VPN等多種功能。

### UTM 的特色：

* **多合一**：把多種安全功能集中管理，減少設備數量和管理複雜度。
* **方便管理**：透過單一介面，統一設定與監控網路安全狀況。
* **適合中小企業**：提供全方位的安全防護，但成本和管理負擔比多套專門設備低。

---

## 監控
除了依靠城市，專業資安人員監控；分析數據

監控涉及追蹤資料在網路中的流動、電腦上檔案的儲存，以及記錄電腦系統的操作或處理日誌。

### 日誌

**日誌**是一種記錄資料傳輸或程式處理細節的檔案。例如：網路通訊日誌。

例如，路由器日誌會記錄連線嘗試、驗證失敗的情況，以及頻道切換事件。

透過監控這些日誌，我們可以偵測到網路攻擊的徵兆，例如不尋常的登入嘗試或未經授權的系統活動。

---

## 監控管理工具

###  SIEM（安全資訊與事件管理系統）

**SIEM**（security information and event management）系統會從防火牆、伺服器和應用程式等來源收集並分析安全資料，能夠偵測異常行為並針對潛在威脅產生警報。

**主要特點**

* **即時偵測**：能辨識可疑行為，例如異常登入、資料外洩或惡意程式特徵。
* **輸出**：產生警報和**事件資料，供進一步調查分析使用**。

### SOAR（安全協調、自動化與回應平台）

**SOAR**（security orchestration, automation, and response） 平台能自動處理由 **SIEM** 所產生的警報，協調不同團隊與工具之間的工作流程，減少人工作業，加速威脅回應。

**主要特點**

* **自動化**：可**自動執行任務**，如封鎖惡意 IP、隔離受感染系統或管理事件處理單。
* **輸出**：提升回應速度，優化處理流程。

---

### 5. **EDR, NDR, XDR**

這三者都是現代網路安全中進階的威脅偵測與回應技術，主要是建立在持續監控基礎上的智能偵測系統，針對不同面向的攻擊行為提供深度防護。


#### 1. **EDR（Endpoint Detection and Response，端點偵測與回應）**

* **作用範圍**：聚焦於終端設備（如筆電、桌機、伺服器、行動裝置等）。
* **功能**：即時監控端點行為，偵測並回應複雜攻擊，如無檔案惡意軟體（fileless malware）、勒索軟體、持續滲透攻擊（APT）。
* **優點**：

  * 詳細紀錄端點活動（進程、網路連線、文件變更）。
  * 支援快速調查和回溯攻擊軌跡。
  * 能自動隔離受感染設備或終止惡意程序。
* **適用場景**：端點被駭入或攻擊的情況，尤其是傳統防毒軟體無法偵測的威脅。


#### 2. **NDR（Network Detection and Response，網路偵測與回應）**

* **作用範圍**：針對整個企業網路流量，特別是內部橫向移動和加密流量。
* **功能**：

  * 監控網路封包與流量行為。
  * 利用行為分析與機器學習技術，偵測異常流量或攻擊行為（如橫向移動、異常通訊）。
  * 可在加密流量中進行深度分析（例如TLS解密與分析）。
* **優點**：

  * 能發現內部滲透與橫向擴散攻擊。
  * 輔助識別難以透過端點檢測的威脅。
* **適用場景**：防堵攻擊者在內部網路移動、滲透其他系統的行為。


#### 3. **XDR（Extended Detection and Response，擴展偵測與回應）**

* **作用範圍**：整合多種資料來源，包含端點（EDR）、網路（NDR）、雲端、安全資訊和事件管理系統（SIEM）等。
* **功能**：

  * 將不同安全系統的偵測資料匯集到一個統一平台。
  * 提供整體威脅視圖，支持跨層級、跨環境的分析與回應。
  * 自動化威脅調查與回應流程，提高反應速度與準確度。
* **優點**：

  * 打破安全孤島，實現全面且協同的威脅管理。
  * 減少誤報，提升安全團隊效率。
  * 支援整合第三方安全產品。
* **適用場景**：大型企業或組織需要整合多種安全資料，建立更智能、統一的威脅偵測與應對機制。


### 為什麼現在要用這些技術？

* **威脅日益複雜**：現代攻擊多層且持續，單一監控無法全面防禦。
* **環境多元**：雲端、端點、網路設備混合存在，需要跨層級協同偵測。
* **自動化需求**：安全事件頻繁，自動化偵測與回應減少人力負擔。
* **加密流量增加**：傳統網路監控難以分析加密流量，NDR等技術能補足這部分盲點。

---

## 資安相關團隊

### SOC（安全營運中心）

SOC（Security Operations Center ）是一個負責**持續監控**與防禦組織 IT 環境的團隊。他們運用 **SIEM** 和 **SOAR** 工具，實時追蹤、分析並回應各種資安事件。

**主要任務：**

* 監控來自 **SIEM** 的警報，進行事件分類與處理，必要時進行升級通報。
* 利用 **SOAR** 工具提升回應流程的效率。

### CSIRT（電腦資安事件應變小組）

當**資安事件被確認後**，CSIRT（Computer Security Incident Response Team） 負責接手處理。他們管理攻擊的隔離、緩解與復原工作。

**主要任務：**

* 調查具體事件（例如：惡意程式感染、資料外洩等）。
* 進行鑑識分析，並提供事件後的報告與改進建議。


### **IDS/IPS** 如何與 **SIEM**、**SOAR**、**SOC** 和 **CSIRT** 協同運作：

* **SIEM**：**IDS** 和 **IPS** 系統會將日誌和警報傳送到 **SIEM**。**SIEM** 從多個來源聚合資料並分析其模式，提升偵測能力。

  * 範例：**SIEM** 可能會將來自 **IDS** 的 SQL 注入嘗試警報與其他日誌相關聯，以確認是否為更大規模攻擊的一部分。

* **SOAR**：**SOAR** 自動化回應由 **IDS/IPS** 偵測到的威脅。它可以封鎖 IP、隔離系統並生成事件處理單。

  * 範例：如果 **IPS** 封鎖了一個惡意 IP，**SOAR** 可自動豐富警報內容、建立事件單，並通知 **SOC**。

* **SOC**：**SOC** 團隊監控 **IDS/IPS** 警報，調查潛在威脅，並使用 **SIEM** 和 **SOAR** 進行資料關聯與工作流程自動化。

  * 範例：當 **IPS** 封鎖可疑連線後，**SOC** 團隊會調查這是否為誤報，或是否為更大攻擊的一部分。

* **CSIRT**：當發生重大事件時，**CSIRT** 會進行更深入的分析、鑑識調查，並協助恢復作業。

  * 範例：如果攻擊繞過了 **IPS** 或初期未被偵測，**CSIRT** 會從 **IDS/IPS** 的日誌中追蹤攻擊並進行應對。


---

## Anomaly Detection
TSMS 抓內鬼
觀察通訊的特性(連接時間、通訊方式、連接者、操作的種類)
看看這則通訊是否存在於異於一班通訊的地方
EX: 是班時間外， 陌生裝置

**TSMS** (Threat Signal Monitoring System) can be used to detect insider threats by monitoring communication patterns (e.g., connection times, methods, and the type of activity).

### Key Approach:

* Identify unusual behaviors in communication, such as logins at odd hours or connections from unfamiliar devices.

Example: A communication occurring outside regular hours or from an unfamiliar device could indicate suspicious activity.

---

## 原罪

## 偵測問題

這邊針對偵測攻擊、惡意行為進一步討論，做不到。補上實際案例 [^2] [^3] [^4] [^5]
從許多被駭卻未觸發警報，且潛伏時間動輒好幾個月到好幾年之上，就可以窺見，偵測沒有用。[^6]
特徵法問題
換個特徵

A100
基線運練問題
不含攻擊的網路流量資料很難，若訓練資料包含攻擊，攻擊則可能被納入基線，使用時反而忽視攻擊

217 測試十款商用網路入侵偵測產品 大部分都難敵刻意地規避 且1990年代的技巧都還管用
通訊加密

安全指示 數據被竄改

## 應對問題
IPS立即採取行動不見得好，假警報，服務可以一職中斷
SOC淹沒在數據中。

## 數據判讀困難
在DNC被駭事件，即使當時荷蘭甚至有影片可以證明DNC遭到入侵，還是在通報、調查無異狀、通報、調查無異狀來回了9個多月。
IDS看到封包在網路上通過，無法確定真的會抵達目的地電腦，也無法得知電腦會如何解讀那些分包
看了寂寞
## LOG
too much data
not enough data
poor information delivery
false positives
hard-to-get data
redundant and inconsistent data
heterogeneous IT environments

## 假警報問題
在Neiman Marcus駭客入侵造成偵測產生超過6萬次警報，但這數量只是每天生成的總警報數的百分之一[^1]


## 註解
筆者抱歉，上一張要探討的是服毒軟體使用特徵碼模式，無法找到變種、新型的病毒。


[^1]: https://www.pcmag.com/news/neiman-marcus-hackers-set-off-nearly-60k-alarms
[^2]: https://www.ithome.com.tw/news/170196
[^3]: https://www.ithome.com.tw/news/170299
[^4]: https://www.ithome.com.tw/news/169984
[^5]: https://www.ithome.com.tw/news/169384
[^6]: https://www.ithome.com.tw/news/169065