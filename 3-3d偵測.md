# 【22】資安的原罪 ch.3-3.d 監控、偵測與回應


---

## Monitoring

Monitoring involves tracking the flow of data across the network, storing files on computers, and recording the operations or processing logs of computer systems.

### Logs

A **log** is a file that records details about data transmission or program processing. Example: Network communication logs.

Router logs, for instance, record attempts to connect to the router, failed authentication attempts, and channel switching events.

By monitoring these logs, we can detect signs of network attacks, such as unusual login attempts or unauthorized system activities.

---

## WAF (Web Application Firewall)

A **WAF** actively monitors web application traffic, focusing on detecting and blocking attacks that exploit vulnerabilities in web applications, such as:

* **SQL Injection**
* **Cross-Site Scripting (XSS)**
* Other web-specific threats

### Key Points:

* **WAFs** are integral to a broader security strategy, acting as a barrier between web applications and potential attackers. They log events, send alerts, and integrate with **SIEM** or **SOAR** tools for incident response.
* **WAFs** are preventive in nature, similar to **IPS**-like systems, but are specifically tailored to handle web traffic.

---

## IDS (Intrusion Detection System)

An **IDS** monitors network traffic or host activities to detect signs of attacks or suspicious behavior. It complements firewalls by detecting attacks that may pass through allowed traffic (e.g., from the internet).

### Key Features:

* **Detection**: The IDS looks for patterns or characteristics of known attacks in the traffic or logs.
* **Baseline**: It establishes a normal behavior baseline and flags deviations as suspicious.


### Types of IDS:

1. **NIDS (Network Intrusion Detection System)**:

   * Monitors network traffic to detect attacks or policy violations.
   * Detects issues like DDoS attacks, port scans, malware traffic.
   * Example: A **NIDS** might flag abnormal traffic from a specific IP address, indicating a potential DDoS attack.

2. **HIDS (Host Intrusion Detection System)**:

   * Monitors activities on individual hosts (e.g., servers or desktops).
   * Detects file tampering, privilege escalation, and malware activity.
   * Example: A **HIDS** might flag an unauthorized attempt to modify system files on a server.

---

## IPS (Intrusion Prevention System)

An **IPS** builds upon the functionality of an **IDS** but adds a prevention layer, actively blocking malicious traffic in real time.

### Key Features:

* **Prevention**: It takes immediate action, such as blocking packets, IP addresses, or terminating malicious sessions.
* **Output**: Acts to stop attacks, preventing them from succeeding.



---

## Tools for Security

### 1. SIEM (Security Information and Event Management)

A **SIEM** system collects and analyzes security data from sources like firewalls, servers, and applications. It detects anomalies and generates alerts for potential threats.

### Key Features:

* **Real-time detection**: Identifies suspicious activities like unusual logins, data exfiltration, or malware signatures.
* **Output**: Generates alerts and event data for further investigation.

---

### 2. SOAR (Security Orchestration, Automation, and Response)

**SOAR** platforms automate responses to alerts generated by **SIEM**. It orchestrates workflows across teams and tools, reducing manual work and accelerating threat response.

### Key Features:

* **Automation**: Automates tasks such as blocking malicious IPs, isolating infected systems, or managing incident tickets.
* **Output**: Faster response times and streamlined workflows.

---

## Teams for Incident Response

### 3. SOC (Security Operations Center)

The **SOC** is a team responsible for continuous monitoring and defending an organization's IT environment. They use **SIEM** and **SOAR** to track, analyze, and respond to security incidents in real-time.

### Key Activities:

* Monitor alerts from **SIEM**, triage incidents, and escalate as necessary.
* Leverage **SOAR** for efficient response workflows.

---

### 4. CSIRT (Computer Security Incident Response Team)

The **CSIRT** takes over once a security incident is confirmed. They manage the containment, mitigation, and recovery of the attack.

### Key Activities:

* Investigate specific incidents (e.g., malware infections, breaches).
* Perform forensics and offer post-incident analysis and reporting.

---

### How **IDS/IPS** Work With **SIEM**, **SOAR**, **SOC**, and **CSIRT**:

* **SIEM**: **IDS** and **IPS** systems send logs and alerts to **SIEM**. The **SIEM** aggregates data from multiple sources and analyzes it for patterns, improving detection capabilities.

  * Example: The **SIEM** might correlate an **IDS** alert about an attempted SQL injection with other logs to confirm whether it’s part of a larger attack.

* **SOAR**: **SOAR** automates responses to threats detected by **IDS/IPS**. It can block IPs, isolate systems, and generate incident tickets.

  * Example: If an **IPS** blocks a malicious IP, **SOAR** could automatically enrich the alert, create a ticket, and notify the **SOC**.

* **SOC**: The **SOC** team monitors **IDS/IPS** alerts, investigates potential threats, and uses **SIEM** and **SOAR** to correlate data and automate workflows.

  * Example: After an **IPS** blocks a suspicious connection, the **SOC** team investigates whether it’s a false positive or part of a larger attack.

* **CSIRT**: When a serious incident occurs, the **CSIRT** performs deeper analysis, conducts forensics, and helps with recovery.

  * Example: If an attack bypasses the **IPS** or isn't detected initially, **CSIRT** dives into logs from the **IDS/IPS** to trace the attack and respond.

---

## Anomaly Detection
TSMS 抓內鬼
觀察通訊的特性(連接時間、通訊方式、連接者、操作的種類)
看看這則通訊是否存在於異於一班通訊的地方
EX: 是班時間外， 陌生裝置

**TSMS** (Threat Signal Monitoring System) can be used to detect insider threats by monitoring communication patterns (e.g., connection times, methods, and the type of activity).

### Key Approach:

* Identify unusual behaviors in communication, such as logins at odd hours or connections from unfamiliar devices.

Example: A communication occurring outside regular hours or from an unfamiliar device could indicate suspicious activity.


---


## 原罪

## 數據判讀困難
讓筆者想當時DNC被駭事件，即使當時荷蘭甚至有影片可以證明DNC遭到入侵，還是在通報、調查無異狀、通報、調查無異狀來回了9個多月。


IDS看到封包在網路上通過，無法確定真的會抵達目的地電腦，也無法得知電腦會如何解讀那些分包
看了寂寞

## 偵測技術
特徵法問題
換個特徵

基線運練問題
不含攻擊的網路流量資料很難，若訓練資料包含攻擊，攻擊則可能被納入基線，使用時反而忽視攻擊

## 迴避偵測 A100
217 測試十款商用網路入侵偵測產品 大部分都難敵刻意地規避 且1990年代的技巧都還管用
通訊加密

安全指示 數據被竄改

## 假警報問題
在Neiman Marcus駭客入侵造成偵測產生超過6萬次警報，但這數量只是每天生成的總警報數的百分之一[^1]

## LOG

too much data
not enough data
poor information delivery
false positives
hard-to-get data
redundant and inconsistent data
heterogeneous IT environments


[^1]: https://www.pcmag.com/news/neiman-marcus-hackers-set-off-nearly-60k-alarms