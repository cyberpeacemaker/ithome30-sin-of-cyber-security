# 【23】資安的原罪 ch.3-3.e 安全檢測與政策方針

本張

---


### 4) 加入測試與驗證（紅隊/藍隊/紫隊）

* 建議放短節說明：定期進行滲透測試、紅隊演練、紫隊（red+blue）協同，以驗證偵測/回應能力、規則有效性與事件處理演練。

## 安全測試（Security Testing）

**目的：** 找出系統在保密性、完整性、可用性等安全方面的弱點，防止遭到惡意利用。

> ⚠️ **注意事項：** 安全測試可能影響系統穩定性（例如滲透測試造成服務中斷），執行前需有授權與恢復計畫。

### 🛡️ **滲透測試（Penetration Testing / Pen Testing）**

**滲透測試**是對系統、應用程式或網路進行的**模擬網路攻擊**，旨在**發現並利用安全弱點**——像真實的攻擊者一樣。它本質上是由資安專業人員執行的**倫理駭客**行為，用來評估系統抵禦現實攻擊的能力。

🎯 **目的：**

* 在惡意駭客之前找出安全弱點。
* 評估現有安全控管的有效性。
* 測試事件回應與偵測能力。
* 確保符合安全標準（例如 PCI-DSS、ISO 27001）。

🧰 **滲透測試常用工具：**

* **Kali Linux**
* **Metasploit**
* **Burp Suite**
* **Nmap**
* **Wireshark**

#### 🔍 **執行流程：**

1. **規劃與偵察（Planning & Reconnaissance）**

* 定義測試範圍（例如：網站應用、網路、API）。
* 蒐集資訊（域名、IP、所使用的軟體等）。

2. **掃描（Scanning）**

* 使用自動化工具掃描弱點。
* 類型：

  * **靜態分析（Static analysis）** – 檢視程式碼。
  * **動態分析（Dynamic analysis）** – 執行應用並監控行為。

3. **取得存取（Gaining Access）**

* 利用發現的弱點（例如 SQL 注入、XSS、弱密碼）進行攻擊。
* 目標：取得系統控制或提權。

4. **維持存取（Maintaining Access）**

* 嘗試在系統內不被發現地長期存在（模擬真實攻擊者）。
* 測試持久性方法。

5. **分析與報告（Analysis & Reporting）**

* 記錄被利用的項目、方式，以及存取到哪些資料。
* 對每個發現的弱點提出緩解建議。

#### 📦 **滲透測試類型：**

| 類型                | 說明                    |
| ----------------- | --------------------- |
| **黑盒（Black Box）** | 測試者對系統一無所知（類似外部駭客情境）。 |
| **白盒（White Box）** | 測試者擁有系統完整資訊（程式碼、架構等）。 |
| **灰盒（Gray Box）**  | 對系統有部分了解（典型的內部威脅情境）。  |

### 🧪 **弱點掃描（Vulnerability Scanning）**

**弱點掃描**是一種**自動化流程**，透過比對已知漏洞資料庫來識別系統、網路或應用程式中已知的安全弱點。可以把它想像成一場**安全健康檢查**，檢查攻擊者可能利用的“開門”處——**但不會實際利用這些漏洞**（與滲透測試不同）。

🎯 **目的：**

* 發現**已知漏洞**（如過時軟體、缺失補丁、設定錯誤）。
* 提供系統安全的**基準**。
* 幫助優先修補與緩解風險。
* 協助符合 PCI-DSS、HIPAA、ISO 27001 等安全標準。

🧰 **常用工具：**

* **Nessus**
* **OpenVAS**
* **Qualys**
* **Rapid7 Nexpose**
* **Microsoft Defender Vulnerability Management**

🔧 **運作流程：**

1. **資產發現**

   * 辨識網路上的 IP 位址、設備與服務。

2. **漏洞偵測**

   * 掃描以下問題：

     * 缺失安全補丁
     * 弱密碼或預設密碼
     * 開放端口
     * 防火牆設定錯誤
     * 過時軟體版本

3. **報告**

   * 產出報告，內容包含：

     * 漏洞列表
     * 嚴重程度（低、中、高、嚴重）
     * 修復建議

#### 📊 **主要特性：**

| 特性       | 說明            |
| -------- | ------------- |
| **自動化**  | 掃描可排程或自動觸發。   |
| **非侵入性** | 不會利用漏洞，只進行偵測。 |
| **快速**   | 速度快於滲透測試。     |
| **頻繁執行** | 可每日、每週或持續執行。  |

#### 📅 **使用時機：**

* 定期（每週或每月）進行漏洞掃描。
* 軟體部署或設定變更前後。
* 作為整體**漏洞管理**或**風險管理**計畫的一部分。

### 🛡️ **安全稽核（Security Auditing）**

✅ **定義：**

**安全稽核**是對組織的**資訊系統**、**安全政策**及**控管措施**進行系統性評估的過程，以確保符合所需的**安全標準**，功能正常且能防範潛在威脅。可視為組織 IT 環境的安全健康檢查。

🎯 **主要目標：**

* ✅ 驗證是否符合內部政策或外部法規（如 GDPR、HIPAA、PCI-DSS）。
* 🔍 找出系統和流程中的安全缺口。
* 📈 透過建議改善方案提升安全態勢。
* 🧾 為利益相關者或稽核人員提供安全狀態文件。

📎 **常用安全稽核標準與框架：**

* **ISO/IEC 27001**
* **NIST 網路安全框架**
* **COBIT**
* **SOC 2**
* **PCI-DSS**
* **HIPAA 安全規則**

#### 🧩 **安全稽核主要組成：**

1. **政策審查**

   * 安全政策是否有制定、最新且有效執行？

2. **存取控制審查**

   * 誰有權限？是否有多餘或閒置帳號？

3. **系統與網路評估**

   * 防火牆、防毒、入侵偵測系統是否配置及運作正常？

4. **資料保護檢查**

   * 敏感資料是否加密？資料備份狀況？

5. **漏洞評估**

   * 系統是否打好補丁？已知漏洞是否有處理？

6. **事件應變審查**

   * 是否有明確應對資安事件的流程？

7. **實體安全**

   * 伺服器、資料中心及端點的物理存取是否受控？

8. **稽核日誌**

   * 是否有活動記錄？能追蹤何人何時做了什麼？

#### 🛠️ **安全稽核類型：**

| 稽核類型     | 說明               |
| -------- | ---------------- |
| **內部稽核** | 由內部團隊執行，評估內部控管。  |
| **外部稽核** | 由獨立第三方執行，提供客觀評估。 |
| **合規稽核** | 專注於法律或法規的遵循情況。   |
| **營運稽核** | 評估日常安全實務及運作狀況。   |

#### 📊 **稽核流程（高階）：**

1. **規劃**

   * 定義範圍（如特定系統、部門）。
   * 設定稽核目標。

2. **資訊收集**

   * 收集系統設定、日誌、存取清單、政策文件。

3. **評估**

   * 依據標準（如 NIST、ISO 27001）進行評估。
   * 執行漏洞掃描，檢查程式碼與設定。

4. **報告**

   * 記錄發現：風險、嚴重度及建議行動。

5. **修正與追蹤**

   * 修復問題。
   * 再次稽核以確認修復成果。

#### 🧠 **安全稽核重要性：**

* 在攻擊者之前偵測安全風險。
* 降低資料外洩風險。
* 建立客戶與利益相關者信任。
* 避免法律罰款與違規風險。

### 🔐 **靜態與動態應用安全測試（SAST & DAST）**

這是辨識應用程式安全漏洞的兩種關鍵方法，特別適用於開發與測試階段。

#### 🧱 **1. 靜態應用安全測試（SAST）**

SAST 在**不執行程式**的情況下，分析應用程式的**原始碼、位元碼或二進位碼**來發現安全漏洞。

就像是在程式碼執行前校對找出安全缺陷。

🔍 **主要特性：**

* 白盒測試（完整程式碼存取）。
* 於軟體開發生命週期（SDLC）早期進行。
* 可偵測：

  * SQL 注入
  * 跨站腳本攻擊（XSS）
  * 不安全的 API 呼叫
  * 硬編碼的密碼或金鑰
  * 程式碼品質問題

🛠️ **常用 SAST 工具：**

* **SonarQube**
* **Checkmarx**
* **Fortify Static Code Analyzer**
* **Veracode（靜態）**
* **Bandit**（Python）
* **ESLint**（JavaScript/TypeScript）

#### 🌐 **2. 動態應用安全測試（DAST）**

DAST 分析**正在執行的應用程式**，從外部模擬真實攻擊來找出安全漏洞，不需要程式碼存取。

就像扮演駭客測試一個活生生的應用。

🔍 **主要特性：**

* 黑盒測試（無程式碼存取）。
* 部署至測試或預備環境後進行。
* 可偵測：

  * 執行時漏洞（認證繞過、邏輯錯誤）
  * 輸入驗證問題
  * 不安全的會話管理
  * 注入漏洞

🛠️ **常用 DAST 工具：**

* **OWASP ZAP**
* **Burp Suite**
* **Acunetix**
* **AppSpider**
* **Netsparker**

#### ⚖️ **SAST 與 DAST 比較表**

| 特性        | SAST     | DAST            |
| --------- | -------- | --------------- |
| **程式碼存取** | 需要原始碼    | 不需程式碼存取         |
| **測試階段**  | 早期（開發階段） | 後期（執行時）         |
| **測試類型**  | 白盒測試     | 黑盒測試            |
| **偵測範圍**  | 程式碼層面缺陷  | 執行時漏洞           |
| **速度**    | 小型程式碼較快  | 較慢（需運行應用）       |
| **誤報率**   | 較高       | 較低，但可能漏掉深層程式碼問題 |
| **覆蓋範圍**  | 限於分析的程式碼 | 涵蓋實際行為          |
| **適合對象**  | 開發人員     | 安全測試人員          |

#### 🛡️ **最佳實務：雙管齊下**

為了達到完整安全防護：

* 在開發階段使用 **SAST**，及早發現程式碼缺陷。
* 在 QA/預備環境使用 **DAST**，檢測執行時漏洞。

這種雙重方法常見於 **DevSecOps** 策略中。

---

## 黑箱測試（Black-box Testing）

**定義：** 測試者不需要知道系統內部實現，只根據需求或介面輸入輸出來驗證系統行為。
**常用技術：**

TODO: 模糊 搭配 等價劃分&邊界值?
* 模糊測試（Fuzzing / Fuzz Testing）：對介面輸入大量隨機、畸形或邊界資料以找崩潰或未處理的錯誤。
* 等價類劃分（Equivalence Partitioning）：把輸入空間分成等價類，代表性測資取自各類別。
* 邊界值分析（Boundary Value Analysis）：針對輸入的邊界值及附近數值設計測試，用以捕捉常見錯誤。
  **優點：** 不依賴內部實作，適合驗證需求與整體功能。
  **注意事項：** 不能保證覆蓋所有內部路徑；設計測資時應結合等價類與邊界分析提升效率。

### 模糊測試（Fuzzing）

**定義：** 自動化輸入大量隨機或畸形資料到系統介面（API、檔案解析器、網路服務等），觀察異常行為（崩潰、資源耗盡、例外）。
**適用場景：** 對外解析複雜格式（例如圖檔、JSON、XML、協定封包）的元件，以及網路服務與API。
**優點：** 能快速發現記憶體錯誤、邏輯崩潰、未處理的例外情形。
**注意事項：** 需結合監控（崩潰紀錄、例外堆疊）與範本化輸入（mutation 或 generation）以提高命中率。

**等價劃分技術（Equivalence Partitioning）**

**定義：** 將輸入或輸出分成若干等價類，假設同一類內任一個值都會產生相同的處理結果，從每類挑選代表值做測試。
**優點：** 減少測試數量而保證代表性；適合功能驗證。
**注意事項：** 分類不當會漏測；最好搭配邊界值分析使用。

**邊界值分析法（Boundary Value Analysis）**

**定義：** 重點測試輸入或狀態的邊界值以及邊界附近的值（例如最大值、最小值、剛超出/剛不及的值）。
**優點：** 許多錯誤出現在邊界處，邊界測試效率高。
**注意事項：** 對連續/離散範圍皆適用，但要覆蓋正負向邊界與特殊值（null、空字串等）。


## 白盒測試（White-box Testing / Clear-box）

**定義：** 測試者了解系統內部結構與程式碼，設計測試以覆蓋特定程式路徑、條件或分支。
測試時考慮內部結構，檢察系統內部的程式是否按照預期運作
經常用在是否正確發揮功能的單元測試中
**常見形式：**

* 單元測試（Unit Testing）：針對最小模組（函式、類別）驗證其行為與邏輯。
* 集成測試（Integration Testing）：檢驗模組間互動是否正確。
  **優點：** 可驗證內部邏輯、條件分支、例外處理；有助於發現隱藏的邏輯錯誤。
  **注意事項：** 需要程式碼可測性（例如依賴注入、模擬物件），過度依賴實作細節可能導致測試維護成本上升。

### 單元測試（Unit Testing）

**定義：** 對程式中的最小可測單位（函式、方法、類）進行的測試，通常由開發者撰寫並自動化執行。只檢查模組等系統組建是否正常運作的測試
**特色與好處：**

* 快速回饋（及早發現問題）
* 有助於重構（保障行為不變）
* 可達到高覆蓋率（程式邏輯、分支）
  **注意事項：** 單元測試需保持快速、獨立（避免與外部系統互賴），對外部依賴應使用模擬（mock）或替身（stub）。



## 源碼檢視 / 靜態分析（Code Review & Static Analysis）

**定義：**

* 源碼檢視：人工或同儕審查程式碼，尋找邏輯錯誤、風格問題、安全隱患與可維護性問題。
* 靜態分析：使用工具在不執行程式的情況下分析程式碼（找記憶體漏洞、未初始化變數、潛在的安全風險等）。
  **優點：** 可以早期抓到錯誤、提升程式品質與一致性，靜態工具尤其擅長發現難以透過測試覆蓋到的缺陷。
  **注意事項：** 靜態分析會產生誤報，需要人工判讀；源碼檢視需要良好流程與檢視規範以提高效率。

---

## 🛡️ **威脅模型**

**威脅建模**是一種**有結構的方法**，用來**識別、評估及優先排序系統、應用程式或流程中潛在的安全威脅**，在這些威脅被利用之前進行防範。

**威脅模型**是此流程的**產出物**，通常以文件化的圖表或框架呈現，展示威脅、漏洞與緩解措施。

### 🎯 **目的：**

* 了解攻擊者可能如何針對你的系統發動攻擊。
* 在設計或開發早期識別**安全弱點**。
* 指導防禦措施的部署決策。
* 透過主動應對威脅來降低整體風險。

### 🔄 **威脅建模的一般步驟：**

1. **定義範圍與資產**

   * 你要保護的是什麼？（例如資料、系統、流程）
   * 確認邊界與組件。

2. **建立系統模型**

   * 繪製資料流程、組件與信任邊界。
   * 使用像是 **資料流程圖（DFD）** 的工具。

3. **識別威脅**

   * 使用框架如 **STRIDE**：

     * **S** 偽裝身份（Spoofing）
     * **T** 數據篡改（Tampering）
     * **R** 否認威脅（Repudiation）
     * **I** 資訊洩露（Information disclosure）
     * **D** 拒絕服務（Denial of service）
     * **E** 權限提升（Elevation of privilege）
   * 考慮攻擊者的目標與能力。

4. **評估與優先排序風險**

   * 評估每個威脅的影響及可能性。
   * 使用風險評分模型如 **DREAD** 或 **CVSS**。

5. **制定緩解措施**

   * 定義安全控管或設計變更以降低風險。
   * 例如：認證、加密、日誌記錄、輸入驗證。

6. **審查與持續迭代**

   * 隨系統演進不斷更新模型。

### 🧩 **常見的威脅建模技術：**

| 技術                    | 說明                       |
| --------------------- | ------------------------ |
| **STRIDE**            | 將威脅分類為六大類別。              |
| **PASTA**             | 攻擊模擬與威脅分析流程，一種以風險為中心的方法。 |
| **OCTAVE**            | 著重於組織的威脅評估。              |
| **攻擊樹（Attack Trees）** | 將威脅以樹狀結構視覺化，展示攻擊與子攻擊。    |

### 📊 **威脅建模的好處：**

* 及早發現設計缺陷。
* 清楚了解攻擊面。
* 促進安全、開發與業務團隊間的溝通。
* 透過提前修正問題節省後期成本。

---

## 安全方針

### 這些主題是什麼？

* **VLAN、DMZ：**
  這些屬於**網路架構與區隔**的概念。VLAN（虛擬區域網路）和 DMZ（非軍事區域）用來隔離網路中的不同部分，以控制流量並提升安全性。

* **最小權限原則（Principle of Least Privilege）、強制存取控制（MAC）、職責分離（Separation of Duties）、完全仲裁（Complete Mediation）、安全預設（Fail-Secure Defaults）：**
  這些是**資訊安全原則與存取控制模型**，用來指導如何設計權限與控制機制，以保護系統與資料。

* **多層防禦、縱深防禦（Defense in Depth）：**
  這是**整體安全策略框架**，強調透過多重、重疊的控制措施來保護資產。


## 縱深防禦（Defense in Depth）

縱深防禦是一種多層次的安全策略，透過多重防線相互配合，強化系統整體的防護能力，降低單點失敗帶來的風險。
其核心理念是：**多多益善**，即在系統各層面設置多種防禦措施，從而提高整體安全性。

### 三大防禦層面

1. **入口對策（Preventive Controls）**
   目標是阻止非法入侵，保護系統不被未授權者進入。包含防火牆、入侵偵測系統（IDS）、身份驗證機制、網路隔離等。

2. **內部對策（Containment Controls）**
   當入侵發生時，限制攻擊者行動範圍，防止攻擊擴散到系統其他部分。包括分段網路架構、嚴格權限管理、監控與警報機制等。

3. **出口對策（Prevent Data Leakage）**
   防止機密資料或重要資產被非法外洩。常見技術有資料加密、資料外洩防護（DLP）系統，以及流量監控等。

### 事後應對

* **損害降低**：即使系統遭到入侵，也要透過防禦層級及時發現與限制損害範圍。
* **提早偵測與響應**：利用監控與異常偵測工具，快速察覺攻擊行為並啟動應變措施，防止損失擴大。

## 多重防禦（Multiple Layers of Defense）

多重防禦策略強調在入口設置多種不同類型的防禦機制，以提升阻擋非法入侵的成功率。
例如，結合防火牆、身份認證、多因素驗證（MFA）、行為分析、流量過濾等技術，形成多道安全門檻。

**好處：**

* 降低單一防禦失效的風險
* 增加攻擊者的入侵難度和成本

---

## 原則

* 最小權限原則（Principle of Least Privilege）
最小權限是資訊安全中的基石原則之一，意指每個使用者或系統元件僅被授予執行任務所需的最低權限。
這能有效限制惡意程式或內部威脅造成的破壞範圍。


* **強制存取控制（Mandatory Access Control, MAC）**
  由系統強制規定權限，使用者無法自行調整，確保權限管理嚴格而一致。

* **權責區分（Separation of Duties）**
  將關鍵任務拆分給多個人或系統單位執行，TODO:避免權力過度集中而被濫用。一個任務兩個以上完成。

* **完全仲裁（Complete Mediation）**
  每次存取行為都需經過權限驗證，不可繞過或跳過安全檢查。

* **失效安全預設（Fail-Secure Defaults）**
  系統預設應該是拒絕存取（deny by default），除非明確授權，避免權限過度開放。

---

## VLAN（虛擬區域網路）

VLAN 是一種透過軟體方式將物理網路切割成多個邏輯子網路的技術。
透過 VLAN，可以將同一實體交換機上的裝置分隔在不同的網段中，實現網路隔離與安全控制，減少廣播風暴並提升網路管理彈性。

**優點：**

* 增加網路安全性（隔離敏感設備與一般使用者）
* 簡化網路管理（按部門或功能分組）
* 減少不必要的流量擴散，提高效率


## DMZ（非軍事區，Demilitarized Zone）

DMZ 是一個特殊的網路區域，通常用來放置對外服務的伺服器（例如網頁伺服器、郵件伺服器、DNS伺服器）。
這個區域介於內部網路與外部公網之間，能隔離外部攻擊與內部重要資產，提供一層額外的安全防護。

## DMZ 的架構特點

* **雙重防火牆保護**
  網頁伺服器等公開服務通常會被部署在 DMZ，並由兩道防火牆包圍：

  1. **外層防火牆**：防止未授權的外部訪問進入 DMZ。
  2. **內層防火牆**：防止來自 DMZ 的攻擊或入侵蔓延至內部網路。

這種雙重防護架構有效降低外部攻擊直接威脅內部系統的風險，同時保障公開服務的可用性與安全性。

---

TODO:
## 開發安全
防駭撰寫實務 writing secure code 該書在備忘錄祭出幾周內直竄亞馬遜銷售榜首
微軟SDL
visual studio .net 邊憶起產品內建堆疊保護機制 有助於舒緩堆疊基礎的歡衝區溢位風險
stack guard

## 安全開機
TPM trusted platform module 安全晶片
保管金鑰 還有各種密鑰和雜湊職相關的計算功能

以信任練的方式進行安全的開基程序
信任練chain of trust, A信B B信C 一環一環
信任根rot root of trust 具有防竄改性的硬體

> 信任根被感染控制

## 資安管理

---

## SIN

### 安全測試
模糊測試 仰賴 輸入
亂槍打鳥 通過也不代表沒有

白鄉測試
無法找到沒想到的漏洞 
對單模組的檢查 也無法找出因模組不相容產生的錯誤

弱點掃描
掃已知 無法找到未曾被發現的新弱點

SATAN
有若掃 還是有超過6盛網站 沒有修復可被偵測的弱點 A81


## 安全方針
縱身多重
一個環境不斷導入添加安全措施，會增加環境的複雜性
複雜增加困難 
三哩島的核能反應旅之所以會部分容毀，多少是因為安全性與保全性的措施複雜性造成[^1]

資安在對抗複雜


## 資安管理困難
美國國家標準暨技術研究院(NIST) 的 "資訊系統與組織的的安全與隱私管控" (Security and Privacy Controls for Information Systems and Organizations)
混亂 無效率 面積太大
遵循框架 拿高分 不依定代表組織的實際安全性
### 資安鐵三角
機械式答案
但與實際上操作存在

##

通訊部掃描
電腦為了接收各種來自網路的服務，擁有很多對外的開赴

沒有用卻是開放的，攻擊者就會嘗試從這個通訊部入侵
就像家裡的門沒上鎖對外敞開
攻擊者也可以用通訊部掃描檢查你裝置有無開放的通訊部
使用者了解通訊部的用途 不實際


[^1]: https://zh.wikipedia.org/zh-tw/%E4%B8%89%E5%93%A9%E5%B2%9B%E6%A0%B8%E6%B3%84%E6%BC%8F%E4%BA%8B%E6%95%85#cite_note-cacophony-9