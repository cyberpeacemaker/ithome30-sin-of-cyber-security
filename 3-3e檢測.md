# 【23】資安的原罪 ch.3-3.e 安全檢測與政策方針

本張

---

## 安全測試（Security Testing）

**目的：** 找出系統在保密性、完整性、可用性等安全方面的弱點，防止遭到惡意利用。

> ⚠️ **注意事項：** 安全測試可能影響系統穩定性（例如滲透測試造成服務中斷），執行前需有授權與恢復計畫。

### 🛡️ **Penetration Testing (Pen Testing)**

**Penetration Testing** is a **simulated cyberattack** against a system, application, or network to **find and exploit security vulnerabilities**—just like a real attacker would.It’s essentially **ethical hacking** conducted by security professionals to assess how well a system can withstand real-world attacks.

🎯 **Purpose:**

* Identify security weaknesses before malicious hackers do.
* Evaluate the effectiveness of existing security controls.
* Test incident response and detection capabilities.
* Ensure compliance with security standards (e.g., PCI-DSS, ISO 27001).

🧰 **Common Tools Used in Pen Testing:**

* **Kali Linux**
* **Metasploit**
* **Burp Suite**
* **Nmap**
* **Wireshark**

#### 🔍 **How It Works:**

1. **Planning & Reconnaissance**

  * Define scope (e.g., web app, network, API).
  * Gather intelligence (domains, IPs, software used).

2. **Scanning**

  * Use automated tools to scan for vulnerabilities.
  * Types:

    * **Static analysis** – Look at code.
    * **Dynamic analysis** – Run the application and monitor behavior.

3. **Gaining Access**

  * Exploit found vulnerabilities (e.g., SQL injection, XSS, weak passwords).
  * Goal: Gain control of systems or escalate privileges.

4. **Maintaining Access**

  * Try to stay undetected in the system (like a real attacker might).
  * Test persistence methods.

5. **Analysis & Reporting**

  * Document what was exploited, how, and what data was accessed.
  * Suggest mitigations for each vulnerability found.

#### 📦 **Types of Penetration Tests:**

| Type          | Description                                                         |
| ------------- | ------------------------------------------------------------------- |
| **Black Box** | Tester has no knowledge of the system (like a real hacker).         |
| **White Box** | Tester has full knowledge of the system (code, architecture).       |
| **Gray Box**  | Partial knowledge of the system (typical internal threat scenario). |



### 🧪 **Vulnerability Scanning**

**Vulnerability scanning** is an **automated process** that identifies known security weaknesses in systems, networks, or applications by scanning them against a database of known vulnerabilities.Think of it as a **security check-up** that looks for "open doors" attackers might use — **without actually exploiting them** (unlike penetration testing).

🎯 **Purpose:**

* Discover **known vulnerabilities** (e.g., outdated software, missing patches, misconfigurations).
* Provide a **baseline** for system security.
* Help prioritize patching and mitigation.
* Assist in **compliance** with standards like PCI-DSS, HIPAA, ISO 27001.

🧰 **Common Tools:**

* **Nessus**
* **OpenVAS**
* **Qualys**
* **Rapid7 Nexpose**
* **Microsoft Defender Vulnerability Management**

🔧 **How It Works:**

1. **Asset Discovery**

   * Identify IP addresses, devices, and services on a network.

2. **Vulnerability Detection**

   * Scan for issues like:

     * Missing security patches
     * Weak/default passwords
     * Open ports
     * Misconfigured firewalls
     * Outdated software versions

3. **Reporting**

   * Generates a report with:

     * List of vulnerabilities
     * Severity levels (e.g., Low, Medium, High, Critical)
     * Recommendations for remediation


#### 📊 **Key Characteristics:**

| Feature           | Description                                         |
| ----------------- | --------------------------------------------------- |
| **Automated**     | Scans are scheduled or triggered automatically.     |
| **Non-Intrusive** | Does not exploit vulnerabilities—just detects them. |
| **Quick**         | Faster than penetration testing.                    |
| **Frequent**      | Can be run weekly, daily, or even continuously.     |


#### 📅 **When to Use:**

* Regular (e.g., weekly/monthly) checks for vulnerabilities.
* Before/after software deployments or configuration changes.
* As part of a broader **vulnerability management** or **risk management** program.



### 🛡️ **Security Auditing**

✅ **Definition:**

**Security auditing** is the process of **systematically evaluating** an organization's **information systems**, **security policies**, and **controls** to ensure they meet required **security standards**, function as intended, and protect against potential threats.Think of it like a **security check-up** for your organization's IT environment.

🎯 **Main Goals:**

* ✅ **Verify compliance** with internal policies or external regulations (e.g., GDPR, HIPAA, PCI-DSS).
* 🔍 **Identify security gaps** or weaknesses in systems and processes.
* 📈 **Improve security posture** by recommending fixes and best practices.
* 🧾 **Document security status** for stakeholders or auditors.

📎 **Common Standards & Frameworks Used in Security Auditing:**

* **ISO/IEC 27001**
* **NIST Cybersecurity Framework**
* **COBIT**
* **SOC 2**
* **PCI-DSS**
* **HIPAA Security Rule**

#### 🧩 **Key Components of a Security Audit:**

1. **Policy Review**

   * Are security policies defined, up-to-date, and enforced?

2. **Access Control Review**

   * Who has access to what? Are there unnecessary permissions or dormant accounts?

3. **System & Network Assessment**

   * Are firewalls, antivirus, and intrusion detection systems configured and working properly?

4. **Data Protection Checks**

   * Is sensitive data encrypted? How is data backed up?

5. **Vulnerability Assessment**

   * Are systems patched and up to date? Are known vulnerabilities being addressed?

6. **Incident Response Review**

   * Are there clear procedures for responding to a breach or attack?

7. **Physical Security**

   * Is physical access to servers, data centers, and endpoints properly secured?

8. **Audit Logs**

   * Are activities logged? Can you trace who did what and when?

#### 🛠️ **Types of Security Audits:**

| Audit Type            | Description                                                        |
| --------------------- | ------------------------------------------------------------------ |
| **Internal Audit**    | Conducted by in-house teams to assess internal controls.           |
| **External Audit**    | Performed by independent third parties for an unbiased assessment. |
| **Compliance Audit**  | Focused on specific legal or regulatory requirements.              |
| **Operational Audit** | Evaluates day-to-day security practices and operations.            |

#### 📊 **Audit Process (High-Level):**

1. **Planning**

   * Define scope (e.g., specific systems, departments).
   * Set audit objectives.

2. **Information Gathering**

   * Collect system configs, logs, access lists, policies.

3. **Assessment**

   * Evaluate against standards (e.g., NIST, ISO 27001).
   * Run vulnerability scans, review code/configurations.

4. **Reporting**

   * Document findings: risks, severity, and recommended actions.

5. **Remediation & Follow-up**

   * Fix identified issues.
   * Re-audit to confirm fixes.

#### 🧠 **Why Security Audits Matter:**

* Catch security risks **before** attackers do.
* Reduce risk of **data breaches**.
* Build trust with customers and stakeholders.
* Avoid **legal penalties** and **compliance violations**.

---

### 🔐 **Static and Dynamic Application Security Testing (SAST & DAST)**

These are two key methods used to identify security vulnerabilities in applications, especially during development and testing phases.

#### 🧱 **1. SAST – Static Application Security Testing**

SAST analyzes the **source code, bytecode, or binary** of an application **without executing it** to find security vulnerabilities.

It’s like proofreading code for security bugs **before the app runs**.

🔍 **Key Features:**

* White-box testing (has full access to code).
* Done early in the Software Development Life Cycle (SDLC).
* Detects:

  * SQL injection
  * Cross-site scripting (XSS)
  * Insecure API calls
  * Hardcoded secrets (e.g., passwords, API keys)
  * Code quality issues

🛠️ **Common SAST Tools:**

* **SonarQube**
* **Checkmarx**
* **Fortify Static Code Analyzer**
* **Veracode (Static)**
* **Bandit** (Python)
* **ESLint** (JavaScript/TypeScript)

#### 🌐 **2. DAST – Dynamic Application Security Testing**

DAST analyzes a **running application** to identify security vulnerabilities by simulating real-world attacks **from the outside**, without access to source code.

It’s like testing a live app by acting as a hacker would.

🔍 **Key Features:**

* Black-box testing (no code access).
* Done **after** the app is deployed to a test/staging environment.
* Detects:

  * Runtime issues (e.g., authentication bypass, logic flaws)
  * Input validation problems
  * Insecure session management
  * Injection flaws

🛠️ **Common DAST Tools:**

* **OWASP ZAP**
* **Burp Suite**
* **Acunetix**
* **AppSpider**
* **Netsparker**

#### ⚖️ **SAST vs. DAST – Comparison Table**

| Feature             | SAST                     | DAST                                 |
| ------------------- | ------------------------ | ------------------------------------ |
| **Code Access**     | Requires source code     | No code access                       |
| **Testing Stage**   | Early (development)      | Later (runtime)                      |
| **Type**            | White-box testing        | Black-box testing                    |
| **Detects**         | Code-level flaws         | Runtime issues                       |
| **Speed**           | Fast for small codebases | Slower (needs a running app)         |
| **False Positives** | Higher                   | Lower, but may miss deep code issues |
| **Coverage**        | Limited to code analyzed | Covers actual behavior               |
| **Best For**        | Developers               | Security testers                     |

#### 🛡️ **Best Practice: Use Both Together**

To get complete security coverage:

* Use **SAST** during development to catch code flaws early.
* Use **DAST** during QA/staging to catch runtime vulnerabilities.

This dual approach is often part of a **DevSecOps** strategy.

---

### 黑箱測試（Black-box Testing）

**定義：** 測試者不需要知道系統內部實現，只根據需求或介面輸入輸出來驗證系統行為。
**常用技術：**

TODO: 模糊 搭配 等價劃分&邊界值?
* 模糊測試（Fuzzing / Fuzz Testing）：對介面輸入大量隨機、畸形或邊界資料以找崩潰或未處理的錯誤。
* 等價類劃分（Equivalence Partitioning）：把輸入空間分成等價類，代表性測資取自各類別。
* 邊界值分析（Boundary Value Analysis）：針對輸入的邊界值及附近數值設計測試，用以捕捉常見錯誤。
  **優點：** 不依賴內部實作，適合驗證需求與整體功能。
  **注意事項：** 不能保證覆蓋所有內部路徑；設計測資時應結合等價類與邊界分析提升效率。

### 模糊測試（Fuzzing）

**定義：** 自動化輸入大量隨機或畸形資料到系統介面（API、檔案解析器、網路服務等），觀察異常行為（崩潰、資源耗盡、例外）。
**適用場景：** 對外解析複雜格式（例如圖檔、JSON、XML、協定封包）的元件，以及網路服務與API。
**優點：** 能快速發現記憶體錯誤、邏輯崩潰、未處理的例外情形。
**注意事項：** 需結合監控（崩潰紀錄、例外堆疊）與範本化輸入（mutation 或 generation）以提高命中率。

**等價劃分技術（Equivalence Partitioning）**

**定義：** 將輸入或輸出分成若干等價類，假設同一類內任一個值都會產生相同的處理結果，從每類挑選代表值做測試。
**優點：** 減少測試數量而保證代表性；適合功能驗證。
**注意事項：** 分類不當會漏測；最好搭配邊界值分析使用。

**邊界值分析法（Boundary Value Analysis）**

**定義：** 重點測試輸入或狀態的邊界值以及邊界附近的值（例如最大值、最小值、剛超出/剛不及的值）。
**優點：** 許多錯誤出現在邊界處，邊界測試效率高。
**注意事項：** 對連續/離散範圍皆適用，但要覆蓋正負向邊界與特殊值（null、空字串等）。


## 白盒測試（White-box Testing / Clear-box）

**定義：** 測試者了解系統內部結構與程式碼，設計測試以覆蓋特定程式路徑、條件或分支。
測試時考慮內部結構，檢察系統內部的程式是否按照預期運作
經常用在是否正確發揮功能的單元測試中
**常見形式：**

* 單元測試（Unit Testing）：針對最小模組（函式、類別）驗證其行為與邏輯。
* 集成測試（Integration Testing）：檢驗模組間互動是否正確。
  **優點：** 可驗證內部邏輯、條件分支、例外處理；有助於發現隱藏的邏輯錯誤。
  **注意事項：** 需要程式碼可測性（例如依賴注入、模擬物件），過度依賴實作細節可能導致測試維護成本上升。

### 單元測試（Unit Testing）

**定義：** 對程式中的最小可測單位（函式、方法、類）進行的測試，通常由開發者撰寫並自動化執行。只檢查模組等系統組建是否正常運作的測試
**特色與好處：**

* 快速回饋（及早發現問題）
* 有助於重構（保障行為不變）
* 可達到高覆蓋率（程式邏輯、分支）
  **注意事項：** 單元測試需保持快速、獨立（避免與外部系統互賴），對外部依賴應使用模擬（mock）或替身（stub）。



## 源碼檢視 / 靜態分析（Code Review & Static Analysis）

**定義：**

* 源碼檢視：人工或同儕審查程式碼，尋找邏輯錯誤、風格問題、安全隱患與可維護性問題。
* 靜態分析：使用工具在不執行程式的情況下分析程式碼（找記憶體漏洞、未初始化變數、潛在的安全風險等）。
  **優點：** 可以早期抓到錯誤、提升程式品質與一致性，靜態工具尤其擅長發現難以透過測試覆蓋到的缺陷。
  **注意事項：** 靜態分析會產生誤報，需要人工判讀；源碼檢視需要良好流程與檢視規範以提高效率。


## 滲透測試（Penetration Testing / Pentest）

**定義：** 模擬攻擊者以真實攻擊手法嘗試突破系統防護，包括外部滲透、內部滲透、應用層攻擊與社交工程（視授權而定）。
**流程要點：**

1. 範圍與授權確認（明確哪些系統可以測試）
2. 資訊蒐集（公開資訊、端口掃描等）
3. 漏洞利用（嘗試取得權限或資料）
4. 後續報告與修補建議
   **優點：** 能評估實際被攻破的風險與影響，提供可操作的改進建議。
   **注意事項：** 高風險活動，需簽署授權、安排測試時間，並確保測試期間有回復/備援計畫。

---
## 🛡️ **Threat Modeling Process** (or **Threat Model**)

**Threat modeling** is a **structured approach** used to **identify, assess, and prioritize potential security threats** to a system, application, or process — **before** those threats can be exploited.

A **threat model** is the **output** of this process, often a documented map or framework showing threats, vulnerabilities, and mitigations.

### 🎯 **Purpose:**

* Understand how attackers might target your system.
* Identify **security weaknesses** early in design or development.
* Guide decisions on where to apply defenses.
* Reduce overall risk by proactively addressing threats.

### 🔄 **Typical Steps in the Threat Modeling Process:**

1. **Define the Scope & Assets**

   * What are you protecting? (e.g., data, systems, processes)
   * Identify boundaries and components.

2. **Create a Model of the System**

   * Diagram data flows, components, and trust boundaries.
   * Use tools like **Data Flow Diagrams (DFD)**.

3. **Identify Threats**

   * Use frameworks like **STRIDE**:

     * **S**poofing identity
     * **T**ampering with data
     * **R**epudiation threats
     * **I**nformation disclosure
     * **D**enial of service
     * **E**levation of privilege
   * Consider attacker goals and capabilities.

4. **Assess & Prioritize Risks**

   * Evaluate impact and likelihood of each threat.
   * Use risk scoring models like **DREAD** or **CVSS**.

5. **Determine Mitigations**

   * Define security controls or design changes to reduce risk.
   * Examples: authentication, encryption, logging, input validation.

6. **Review & Iterate**

   * Continuously update the model as the system evolves.

### 🧩 **Common Threat Modeling Techniques:**

| Technique        | Description                                                                 |
| ---------------- | --------------------------------------------------------------------------- |
| **STRIDE**       | Classifies threats into 6 categories.                                       |
| **PASTA**        | Process for Attack Simulation and Threat Analysis, a risk-centric approach. |
| **OCTAVE**       | Organizationally focused threat assessment.                                 |
| **Attack Trees** | Visualize threats as tree structures with attacks and sub-attacks.          |

### 📊 **Benefits of Threat Modeling:**

* Early detection of design flaws.
* Clear understanding of attack surfaces.
* Better communication among security, dev, and business teams.
* Saves cost by fixing issues early rather than post-deployment.

---

## 安全方針
---

### What are these topics?

* **VLAN, DMZ:**
  These are **network architecture/segmentation** concepts. VLANs (Virtual LANs) and DMZs (Demilitarized Zones) help isolate different parts of a network to control traffic and improve security.

* **Principle of Least Privilege, Mandatory Access Control (MAC), Separation of Duties, Complete Mediation, Fail-Secure Defaults:**
  These are **security principles and access control models** that guide how permissions and controls are designed to protect systems and data.

* **Multiple Layers of Defense, Defense in Depth:**
  These are **overall security strategy frameworks** emphasizing multiple overlapping controls to protect assets.

---

### How to arrange them?

1. **Start with the broad strategy** (high-level concepts):

   * **Defense in Depth / Multiple Layers of Defense**
     This sets the stage for why multiple controls and principles exist.

2. **Introduce key security principles** that guide how controls are applied:

   * Principle of Least Privilege
   * Separation of Duties
   * Complete Mediation
   * Fail-Secure Defaults
   * Mandatory Access Control

   Explain how these principles influence security design.

3. **Then move to practical implementation in networks:**

   * VLAN
   * DMZ

   Explain these as examples of network segmentation that help enforce the principles and contribute to defense in depth.


1. Defense in Depth / Multiple Layers of Defense (Overall security philosophy)
2. Security Principles:

   * Principle of Least Privilege
   * Mandatory Access Control
   * Separation of Duties
   * Complete Mediation
   * Fail-Secure Defaults
3. Network Security Architecture:

   * VLANs for network segmentation
   * DMZ as an isolated zone for public-facing services


## 縱深防禦（Defense in Depth）

縱深防禦是一種多層次的安全策略，透過多重防線相互配合，強化系統整體的防護能力，降低單點失敗帶來的風險。
其核心理念是：**多多益善**，即在系統各層面設置多種防禦措施，從而提高整體安全性。

### 三大防禦層面

1. **入口對策（Preventive Controls）**
   目標是阻止非法入侵，保護系統不被未授權者進入。包含防火牆、入侵偵測系統（IDS）、身份驗證機制、網路隔離等。

2. **內部對策（Containment Controls）**
   當入侵發生時，限制攻擊者行動範圍，防止攻擊擴散到系統其他部分。包括分段網路架構、嚴格權限管理、監控與警報機制等。

3. **出口對策（Prevent Data Leakage）**
   防止機密資料或重要資產被非法外洩。常見技術有資料加密、資料外洩防護（DLP）系統，以及流量監控等。

### 事後應對

* **損害降低**：即使系統遭到入侵，也要透過防禦層級及時發現與限制損害範圍。
* **提早偵測與響應**：利用監控與異常偵測工具，快速察覺攻擊行為並啟動應變措施，防止損失擴大。

## 多重防禦（Multiple Layers of Defense）

多重防禦策略強調在入口設置多種不同類型的防禦機制，以提升阻擋非法入侵的成功率。
例如，結合防火牆、身份認證、多因素驗證（MFA）、行為分析、流量過濾等技術，形成多道安全門檻。

**好處：**

* 降低單一防禦失效的風險
* 增加攻擊者的入侵難度和成本


## 最小權限原則（Principle of Least Privilege）

最小權限是資訊安全中的基石原則之一，意指每個使用者或系統元件僅被授予執行任務所需的最低權限。
這能有效限制惡意程式或內部威脅造成的破壞範圍。


* **強制存取控制（Mandatory Access Control, MAC）**
  由系統強制規定權限，使用者無法自行調整，確保權限管理嚴格而一致。

* **權責區分（Separation of Duties）**
  將關鍵任務拆分給多個人或系統單位執行，TODO:避免權力過度集中而被濫用。一個任務兩個以上完成。

* **完全仲裁（Complete Mediation）**
  每次存取行為都需經過權限驗證，不可繞過或跳過安全檢查。

* **失效安全預設（Fail-Secure Defaults）**
  系統預設應該是拒絕存取（deny by default），除非明確授權，避免權限過度開放。

---

## VLAN（虛擬區域網路）

VLAN 是一種透過軟體方式將物理網路切割成多個邏輯子網路的技術。
透過 VLAN，可以將同一實體交換機上的裝置分隔在不同的網段中，實現網路隔離與安全控制，減少廣播風暴並提升網路管理彈性。

**優點：**

* 增加網路安全性（隔離敏感設備與一般使用者）
* 簡化網路管理（按部門或功能分組）
* 減少不必要的流量擴散，提高效率


## DMZ（非軍事區，Demilitarized Zone）

DMZ 是一個特殊的網路區域，通常用來放置對外服務的伺服器（例如網頁伺服器、郵件伺服器、DNS伺服器）。
這個區域介於內部網路與外部公網之間，能隔離外部攻擊與內部重要資產，提供一層額外的安全防護。

## DMZ 的架構特點

* **雙重防火牆保護**
  網頁伺服器等公開服務通常會被部署在 DMZ，並由兩道防火牆包圍：

  1. **外層防火牆**：防止未授權的外部訪問進入 DMZ。
  2. **內層防火牆**：防止來自 DMZ 的攻擊或入侵蔓延至內部網路。

這種雙重防護架構有效降低外部攻擊直接威脅內部系統的風險，同時保障公開服務的可用性與安全性。

---

TODO:
## 開發安全
防駭撰寫實務 writing secure code 該書在備忘錄祭出幾周內直竄亞馬遜銷售榜首
微軟SDL
visual studio .net 邊憶起產品內建堆疊保護機制 有助於舒緩堆疊基礎的歡衝區溢位風險
stack guard

## 安全開機
TPM trusted platform module 安全晶片
保管金鑰 還有各種密鑰和雜湊職相關的計算功能

以信任練的方式進行安全的開基程序
信任練chain of trust, A信B B信C 一環一環
信任根rot root of trust 具有防竄改性的硬體

> 信任根被感染控制




## 資安管理

---

## SIN

### 安全測試
模糊測試 仰賴 輸入
亂槍打鳥 通過也不代表沒有

白鄉測試
無法找到沒想到的漏洞 
對單模組的檢查 也無法找出因模組不相容產生的錯誤

弱點掃描
掃已知 無法找到未曾被發現的新弱點

SATAN
有若掃 還是有超過6盛網站 沒有修復可被偵測的弱點 A81

## 資安鐵三角
機械式答案
但與實際上操作存在


## 安全方針
縱身多重
一個環境不斷導入添加安全措施，會增加環境的複雜性
複雜增加困難 
三哩島的核能反應旅之所以會部分容毀，多少是因為安全性與保全性的措施複雜性造成[^1]

資安在對抗複雜


## 資安管理困難
美國國家標準暨技術研究院(NIST) 的 "資訊系統與組織的的安全與隱私管控" (Security and Privacy Controls for Information Systems and Organizations)
混亂 無效率 面積太大
遵循框架 拿高分 不依定代表組織的實際安全性

##

通訊部掃描
電腦為了接收各種來自網路的服務，擁有很多對外的開赴

沒有用卻是開放的，攻擊者就會嘗試從這個通訊部入侵
就像家裡的門沒上鎖對外敞開
攻擊者也可以用通訊部掃描檢查你裝置有無開放的通訊部
使用者了解通訊部的用途 不實際


[^1]: https://zh.wikipedia.org/zh-tw/%E4%B8%89%E5%93%A9%E5%B2%9B%E6%A0%B8%E6%B3%84%E6%BC%8F%E4%BA%8B%E6%95%85#cite_note-cacophony-9