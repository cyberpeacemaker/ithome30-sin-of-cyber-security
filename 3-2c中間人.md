# 【16】資安的原罪 ch.3-2.c 中間人攻擊

「想像一下，你正在登入網路銀行應用程式，仔細輸入使用者名稱和密碼，並以為自己正在安全地存取帳戶。但你不知道的是，有一個駭客正悄悄攔截你的認證資訊，監視你的一舉一動，甚至更改交易細節。這就是中間人攻擊（Man-in-the-Middle，MITM）的危險——當今資安環境中最隱蔽且危害巨大的威脅之一。」

---

### **什麼是中間人攻擊？**

**中間人攻擊（Man-in-the-Middle，MITM）** 是指駭客秘密攔截並可能篡改兩個彼此以為直接通訊的當事人之間的資訊交換。攻擊者位於資料流的「中間」，通常雙方都不會察覺，使攻擊者能夠竊聽、竊取資訊、注入惡意資料，或冒充其中一方。

* 有時也稱為 **中間敵手攻擊（Adversary in the Middle，AITM）**，強調攻擊者是惡意角色的身份。


### **合法中間人**

* **網際網路服務提供商（ISP）**：能夠攔截未加密的流量、進行監控，甚至修改內容。如果在未經你知情或同意的情況下這麼做，可能會引發隱私疑慮。

* **VPN 業者**：若 VPN 服務商能存取你的加密資料或紀錄日誌，他們就可能被視為一種**受信任的中間人**——也就是他們能解密並查看你的流量。因此，**選擇可信賴的 VPN 供應商非常重要**，以避免隱私受到侵犯。

* **網路管理員（例如學校或公司）**：儘管他們可能出於安全或政策執行的正當理由監控與檢查流量，但他們實際上也處於**通訊過程的中間位置**，理論上可以在使用者不知情的情況下進行監聽或資料操作。

---

### **4. 技術手法：中間人攻擊是如何運作的？**

* **ARP 欺騙（ARP Spoofing / Address Resolution Protocol Spoofing）**

  * 攻擊者在區域網路中發送偽造的 ARP 封包，將自己的 MAC 位址綁定到受害者的 IP 位址。這樣一來，原本發給受害者的資料就會被轉送到攻擊者手中，進而實現攔截。

* **SSL 降級攻擊（SSL Stripping）**

  * 攻擊者將原本安全的 HTTPS 連線降級為不安全的 HTTP，藉此移除加密保護。這讓攻擊者可以查看、修改或插入惡意內容進入通訊中。

* **偽造 DHCP 伺服器攻擊（Rogue DHCP Server Attack）**

  * 攻擊者架設一個假的 DHCP 伺服器，並發送惡意網路設定（例如偽造的閘道器或 DNS 伺服器），藉此將受害者的流量引導到自己身上，達到中間人位置。

* **DNS 欺騙 / 快取污染（DNS Spoofing / Cache Poisoning）**

  * 攻擊者污染 DNS 快取資料，植入錯誤的 DNS 紀錄，使受害者被導向假的網站。攻擊者可藉此竊取登入憑證或植入惡意程式。

* **Wi-Fi 竊聽 / 邪惡雙胞胎攻擊（Evil Twin Attack）**

  * 攻擊者建立一個偽造的 Wi-Fi 熱點，名稱與外觀與合法網路幾乎相同。一旦受害者連接上這個假熱點，他們的所有網路流量就會被攻擊者攔截、查看，甚至修改。

* **會話劫持（Session Hijacking）**

  * 攻擊者竊取合法的會話 Cookie，進而冒充受害者登入系統，而無需知道密碼。這通常透過 MITM 攻擊來攔截受害者登入時傳送的會話憑證。


There are several examples of malware targeting cookies from web browsers on the local system. Adversaries may also steal cookies by injecting malicious JavaScript content into websites or relying on User Execution by tricking victims into running malicious JavaScript in their browser.

There are also open source frameworks such as Evilginx2 and Muraena that can gather session cookies through a malicious proxy (e.g., Adversary-in-the-Middle) that can be set up by an adversary and used in phishing campaigns.

After an adversary acquires a valid cookie, they can then perform a Web Session Cookie technique to login to the corresponding web application.[^2]


### **Summary: Why Is This Important?**

MITM attacks are a serious security threat because they are difficult to detect and can have wide-ranging consequences. By understanding how these attacks work and recognizing the potential impacts, individuals and organizations can take necessary precautions to protect themselves, such as using encryption, securing network connections, and implementing additional layers of security like multi-factor authentication.

### **3. Example: Real-World Scenario**

**Scenario: Public Wi-Fi Attack**

Sarah is sitting in a café, connected to the coffee shop's free Wi-Fi, checking her email and making a few online purchases. What she doesn't know is that a hacker, sitting nearby, has set up a fake Wi-Fi hotspot that mimics the café’s real network. When Sarah connects to the "Free\_CoffeeShop\_WiFi," the attacker intercepts and monitors all of her internet traffic, including sensitive login credentials and credit card information.

In this MITM attack, the attacker not only listens in on Sarah’s communications but could also modify transaction details, redirect her to fake websites, or steal her identity.

TODO: REAL EXAMPLE
B292 New york times
## DNS
「Hazy Hawk」利用DNS錯誤配置劫持知名機構網域[^1]


“HTTPS can be stripped” — also accurate in the sense of SSL/TLS stripping attacks or misconfigurations that downgrade or bypass protections. Explain the concept and show how defenses (HSTS, modern TLS, certificate validation) stop it. Avoid step‑by‑step attack instructions.

---

### Outline: Man-in-the-Browser (MITB)

**1. Definition & Core Idea**

* A **MITB attack** occurs when malware or malicious browser extensions silently alter or intercept data **within the browser**, before it's encrypted or sent.
* Often invisible to both the user and the web application.

> While MITM attacks threaten users on the **network**, MITB attacks bypass network security entirely — turning the user’s **own browser into the attacker’s weapon**. In both cases, layered defense and user awareness are critical.

**2. How MITB Works**

* Requires **local malware or malicious browser plugin**.
* Hooks into the browser via:

  * Browser API manipulation (e.g., DOM injection, JavaScript modification)
  * Browser memory tampering
  * DLL injection (on Windows)
* Data is intercepted **before SSL/TLS**, so encryption doesn’t help.

**5. Real-World Examples**
* Banking trojans (e.g., Zeus, SpyEye, Dyre)
* Fake or modified online forms
* Session hijacking or invisible money transfers
* Stealing login credentials, MFA tokens, or even screenshots

* Zeus (2007–2015): Intercepted bank logins, injected extra fields.
* Dridex, Emotet: Delivered via email, hijacked browsers to steal financial info.
* RedLine stealer, modern crypto wallet stealers: Grabbing session tokens.

**4. MITB vs. MITM: Key Differences**

| Feature            | MITM                                         | MITB                               |
| ------------------ | -------------------------------------------- | ---------------------------------- |
| Target             | Network communication                        | Browser process                    |
| Location           | External (on network)                        | Internal (on infected device)      |
| Requires access to | Network or router                            | Browser or OS                      |
| Visibility to user | Rare, sometimes visible (e.g. cert warnings) | Completely invisible               |
| Bypasses HTTPS     | No                                           | Yes                                |
| Example threat     | Wi-Fi sniffing, DNS spoofing                 | Zeus trojan modifying banking site |

TODO: WIFI BT SMS
---

## 原罪

Signs of MITM (unexpected certificate warnings, slow connection, unusual network behavior)

Monitoring tools and network anomaly detection

### 手不需要伸進裝置
不留痕跡

### 無法


* No visible changes to network traffic.
* Antivirus often fails to detect polymorphic malware.
* Legitimate-looking browser behavior (unless you inspect DOM or form data)

### Why a “quiet” MITM is hard to detect

If the attacker only passively sniffed traffic (e.g., captured packets on an unencrypted Wi‑Fi) and didn’t alter messages, there may be no visible protocol anomalies. Encrypted sessions (TLS) protect content, so passive capture leaves little footprint on the network beyond the capture itself.

If the attacker intercepts and relays (transparent MITM) but preserves TLS correctly (e.g., compromises a client or a CA, or performs a proxy with valid certs on the client), traffic looks normal to endpoints.

Short-lived or low-volume MITMs may not show up in logs, and many default logging levels don’t capture the small anomalies an attacker relies on.


[^1]: https://www.informationsecurity.com.tw/article/article_detail.aspx?aid=11907
[^2]: https://attack.mitre.org/techniques/T1539/