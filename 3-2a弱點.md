# 【14】資安的原罪 ch.3-2.a 零日攻擊

本章介紹頂尖駭客最熱中的技術殿堂，弱點的發現與利用。

---

## 什麼是弱點?

資安中的弱點（vulnerable）是指**系統、軟體、網路或流程**中存在的**缺陷或瑕疵**，攻擊者可以**利用這些弱點**來取得未經授權的存取權，干擾服務，或竊取資料等非法行為。

就像房子有沒鎖好的門窗，弱點就是那些讓攻擊者有機可乘的破口。

## 什麼是弱點利用?

**弱點只是系統的「缺陷或破口」**；當攻擊者設計出一段程式或操作序列，能夠實際利用這個缺陷達成入侵、竊取或破壞，那段程式/方法就叫做 **弱點利用（exploit）**。換句話說：*弱點 = 入口，弱點利用 = 開門的鑰匙或破門的方法。*

**典型攻擊流程（簡化）**

1. **發現（Discovery）**：研究人員或攻擊者發現漏洞。
2. **武器化（Weaponization）**：編寫 exploit（程式、payload、exploit chain）。
3. **利用（Exploitation）**：把 exploit 投放到目標系統並觸發弱點。
4. **後續行動（Post‑exploitation）**：取得權限、橫向移動、蒐集機敏資料或持久化。

> **弱點是問題的「存在」，弱點利用是把問題變成攻擊的「行為」**——理解兩者的連結，才能針對性地防護與檢測。

**現實案例-Heartbleed**

2014年OpenSSL加密函式庫被發現一個重大弱點，攻擊者只要**送出特製請求**，就能從伺服器**讀出最多 64KB 的記憶體資料**，可能包含私鑰、帳號、密碼等敏感資訊，而且不會留下痕跡。
「換句話說，攻擊者可以讀取本不該看到的記憶體，就像透過信封上的小洞偷看密信一樣。」

---

## 常見弱點效果

### 🌐 **遠端程式碼執行（Remote Code Execution, RCE）**

* 攻擊者能在遠端機器上執行任意程式碼
* 是最危險的攻擊之一，**若有執行任意程式碼弱點，基本上等於完全操控了我們的電腦和手機**
* 常見於緩衝區溢位、反序列化漏洞或指令注入

> *「RCE就像有人寄來一個陷阱檔案，然後它開始執行指令，好像駭客坐在你的鍵盤前一樣。」*

###  🔐 **權限提升（Privilege Escalation）**

* 取得比原本允許更高的存取權限
* 例如：弱點讓一般用戶升級成管理員或root
* 常見於本機記憶體錯誤或權限設定不當

> *「就像拿著訪客證走進大樓，卻找到方法打開了主管辦公室的門。」*

### 🕵️‍♂️ **資訊洩漏（Information Disclosure）**

* 敏感資料外洩：密碼、令牌、金鑰、內部程式碼
* 例如Heartbleed洩漏了受影響伺服器的記憶體內容
* 常見於跨站腳本（XSS）、設定錯誤或暴露的API

> *「即使沒有直接控制權，資料洩漏也同樣危險──駭客往往藉此規劃下一步行動。」*

### 📦 **阻斷服務（Denial of Service, DoS）**

* 弱點可讓攻擊者癱瘓或超載系統
* 雖不如程式碼執行來得戲劇化，但仍具破壞力
* 例如資源耗盡、無限迴圈或使系統崩潰的輸入

> *「有時候，攻擊者不想闖入，他們只是想讓一切停止運作。」*

---

## 常見弱點成因

### 1. **記憶體弱點**

**記憶體管理上的缺陷**在像 C 與 C++ 這類語言中特別危險。

**例子包括：**

* 緩衝區溢位 / 緩衝區越界讀取
* Use-after-free（使用已釋放記憶體
* 空指標解引用

> *「這些漏洞讓攻擊者能夠**存取或覆寫他們不該碰的記憶體區域**——可能導致系統當機、資料外洩，甚至遠端代碼執行。」*

對抗記憶體溢位較有效的語言有：JAVA、RUST、C#

### 2. **注入弱點**

當 **不受信任的資料被當作程式碼解讀** 時，就會發生注入攻擊。

**例子包括：**

* SQL 注入
* 命令注入**
* LDAP/XML 注入
* XSS

> *「可以想像成這樣——你問資料庫一個問題，但攻擊者偷渡惡意指令進來，變成執行惡意指令。結果不再是查某個使用者，而是讓資料庫把所有使用者資料全部洩漏出來。」*

儘管這些弱點被廣泛知悉，但它們仍然是網路上被濫用最頻繁的漏洞之一。
防範方法包括：消毒輸入、固定格式，以及使用 PreparedStatement。


#### XSS（跨站腳本攻擊）

XSS（Cross‑Site Scripting） 是一種網頁應用程式漏洞，攻擊者把惡意 JavaScript 或 HTML **注入到網站**中，使其他使用者的瀏覽器在**不知情下執行這些程式碼**，進而竊取資料、篡改頁面或劫持使用者會話。

**常見類型**

* **儲存型（Stored XSS）**：惡意程式碼被儲存在伺服器（例如留言、用戶資料）中，所有讀取該內容的訪客都會被影響。
* **反射型（Reflected XSS）**：惡意程式碼隨 URL 或表單送來，伺服器立刻回顯給使用者（常見於釣魚連結）。
* **DOM‑based XSS**：惡意程式碼只在瀏覽器端改變 DOM（前端處理不當），伺服器不必參與。

**可能的影響**

* 竊取 cookies、session token 或敏感資訊
* 偽造使用者操作（如轉帳、發布內容）
* 注入惡意腳本進行鍵盤記錄、蠕蟲式傳播或偽造 UI

---

## 弱點接露與零日攻擊

### 什麼是「弱點接露」？

弱點接露（Vulnerability Disclosure） 是指當安全研究人員、白帽駭客或使用者發現系統、軟體或服務中的安全缺陷時，將該**發現通報給相關責任方**（例如軟體開發者、服務提供者或資安協調單位）的過程。

### 常見的接露方式與參與單位

* **負責任揭露（Responsible / Coordinated Disclosure）**：研究人員先私下通知廠商，提供修補時間，待修補或達成協議後再公開細節。
* **公開揭露（Full Disclosure）**：在沒有協調或等待期的情況下直接公開漏洞細節（風險較高，可能加速被惡用）。
* **漏洞獎勵計畫（Bug Bounty）**：公司提供獎勵以鼓勵研究者回報漏洞並提供修補資訊。

重要參與單位範例（你可視情境引用或聯絡）：

* **Google Project Zero**：由 Google 支援的資安研究小組，專注於發現高風險漏洞並推動負責任揭露。
* **MITRE / CVE**：MITRE 維護 CVE（Common Vulnerabilities and Exposures）編號系統，是全球通用的漏洞識別標準，便於追蹤與通報。
* **TWNCERT / 國家或區域 CERT**：各國的電腦緊急應變中心（例如台灣的 TWNCERT/CC）提供協調與通報窗口，能協助跨單位溝通與事件處理。

### 什麼是「零日攻擊」？

當某個漏洞在**被公開揭露或有補丁發布之前**，已經被攻擊者發現並實際利用，這種情況稱為 **零日攻擊（Zero‑day attack）**。意思是防守方有「零天」時間去準備或修補，可以說是**無法抵擋**的攻擊。

---

## 原罪

### 1.人一定會出錯
軟體是人寫的，只要是人就有可能出錯，不論多少教育訓練、採用什麼開發架構，也無法避免人為疏失。
從下面案例就可看出思科 [^1] IBM[^2] Chrome [^3] Apple IOS [^4] [^5] Adobe[^6] 微軟[^7]，即使是最頂尖人才組成的最頂尖企業，也無法避免出現弱點。

SQL注入 相對容易預防 卻還是很常見

### 2.光發現無法解決問題

實務上我們主要仰賴弱點懸賞、通報等，來試著枯竭現存的弱點。但弱點的發現辦法對解決弱點起到幫助。而且同類型的弱點找到出現在這處，不代表能存在其他處的同弱點都能被找到，也不代表未來寫的程式能避免這弱點。


### 3.補釘修補
零時差

原因在於，即便廠商釋出修補，但用戶不一定有修補，或是有些漏洞被揭露，但廠商可能因為產品生命週期結束等原因，而不願修補或尚未修補

還沒修補已知弱點

修補程式 逆向工程 發覺與弱點息息相關的線索
成為駭客尋找弱點的燈塔 入侵尚未補丁的裝置
修補星期二 漏洞利用星期三

修補程式發布 不願意更新
安裝後造成的問題 軟體相衝 修補程式造成電腦當季
微軟自己也沒準時安裝補丁"就跟整個產業一樣，都很難在修補程式上按應遵循的標準做到百分之百"
'We, like the rest of the industry, struggle to get 100 percent compliance with our patch management,''
On the other hand, their own actions demonstrate how unrealistic that position is.' [連結](https://www.nytimes.com/2003/01/28/business/technology-worm-hits-microsoft-which-ignored-own-advice.html)

### 4.操作空間與危險

C C++語言讓使用者控制，是優勢，也就會有出錯的空間
### Linux應對
ASLRR 位址空間配置隨機 Address Space Layout Randomization 之前一般都是位在記憶體空間頂部 ASLR隱藏堆疊
ASLR很快失效 駭客找到堆疊位址的方法
推出ESP 可執行空間保護 Executeable Space Protection 會將推疊所在的記憶體為指標是為不可執行 就算破解ASLR找到植入代碼 ESP也會拒絕執行
ESP 失效 Return Oriented Programming返回導向程式設計 不再將惡意軟體植入堆疊 而是尋找堆疊外可以協助完成任位的代碼片段
ROP中 每個片段結尾的指令 都是返回到堆疊 每個片段的記憶體位只放在堆疊上 串接再一起執行惡意程式 
片段跳轉到堆疊 堆疊跳轉到片段 控制程式流




[^1]: https://www.ithome.com.tw/news/170663
[^2]: https://www.ithome.com.tw/news/169768
[^3]: https://www.ithome.com.tw/news/171194
[^4]: https://www.ithome.com.tw/news/169558
[^5]: https://www.ithome.com.tw/news/170738
[^6]: https://www.ithome.com.tw/news/164977
[^7]: https://www.ithome.com.tw/news/171140