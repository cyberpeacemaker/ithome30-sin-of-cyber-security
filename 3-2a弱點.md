# 【14】資安的原罪 ch.3-2.a 零日攻擊

TODO:
絕對防部不了的攻擊
想像你出門時，把家門稍微留了一點縫──不是因為你忘了關門，而是鎖頭本身有缺陷。在數位世界中，這就是「弱點」的意義。它是一種弱點──一個漏洞──攻擊者可以找到並加以利用。

---

## 什麼是弱點?

資安中的弱點是指系統、軟體、網路或流程中存在的缺陷或瑕疵，攻擊者可以利用這些弱點來取得未經授權的存取權，干擾服務，或竊取資料。

想像它是：

* 盔甲上的裂縫。
* 規則中的漏洞。
* 一扇無意間開啟的後門。

### 範例

「讓我用一個例子來說明，程式中一個微小的錯誤怎麼會造成全球規模的資安災難。」
2014年，著名的OpenSSL加密函式庫被發現一個重大弱點──Heartbleed。OpenSSL是保障網路通訊安全的關鍵（想像HTTPS、VPN、電子郵件）。
這個弱點並非因為駭客植入惡意軟體，而是單純記憶體操作上的失誤。

🧠 Heartbleed是什麼？
一種稱為「緩衝區過度讀取」（buffer over-read）的記憶體弱點。
攻擊者可以送出特製請求，誘使伺服器洩漏最多64KB的記憶體資料。
洩漏了什麼？潛在的私鑰、使用者名稱、密碼及其他敏感資料──且不會留下任何痕跡。
「換句話說，攻擊者可以讀取本不該看到的記憶體，就像透過信封上的小洞偷看密信一樣。」

---

## 常見弱點類型

###  🔐 **權限提升（Privilege Escalation）**

* 取得比原本允許更高的存取權限
* 例如：弱點讓一般用戶升級成管理員或root
* 常見於本機記憶體錯誤或權限設定不當

> *「就像拿著訪客證走進大樓，卻找到方法打開了主管辦公室的門。」*

### 🌐 **遠端程式碼執行（Remote Code Execution, RCE）**

* 攻擊者能在遠端機器上執行任意程式碼
* 是最危險的攻擊之一，若有執行任意程式碼弱點，基本上等於完全操控了我們的電腦和手機
* 常見於緩衝區溢位、反序列化漏洞或指令注入

> *「RCE就像有人寄來一個陷阱檔案，然後它開始執行指令，好像駭客坐在你的鍵盤前一樣。」*

### 🕵️‍♂️ **資訊洩漏（Information Disclosure）**

* 敏感資料外洩：密碼、令牌、金鑰、內部程式碼
* 例如Heartbleed洩漏了受影響伺服器的記憶體內容
* 常見於跨站腳本（XSS）、設定錯誤或暴露的API

> *「即使沒有直接控制權，資料洩漏也同樣危險──駭客往往藉此規劃下一步行動。」*

### 📦 **阻斷服務（Denial of Service, DoS）**

* 弱點可讓攻擊者癱瘓或超載系統
* 雖不如程式碼執行來得戲劇化，但仍具破壞力
* 例如資源耗盡、無限迴圈或使系統崩潰的輸入

> *「有時候，攻擊者不想闖入，他們只是想讓一切停止運作。」*

---
## 弱點的原因

### 1. **記憶體弱點**

記憶體管理上的缺陷在像 C 與 C++ 這類語言中特別危險（OpenSSL 就是用這些語言寫的）。

**例子包括：**

* **緩衝區溢位** / **緩衝區越界讀取**（例如 Heartbleed）
* **Use-after-free（使用已釋放記憶體）**
* **空指標解引用**

> *「這些漏洞讓攻擊者能夠存取或覆寫他們不該碰的記憶體區域——可能導致系統當機、資料外洩，甚至遠端代碼執行。」*

對抗記憶體溢位較有效的語言有：JAVA、RUST、C#

### 2. **注入弱點**

當 **不受信任的資料被當作程式碼解讀** 時，就會發生注入攻擊。

**例子包括：**

* **SQL 注入**
* **命令注入**
* **LDAP/XML 注入**

> *「可以想像成這樣——你問資料庫一個問題，但攻擊者偷偷夾帶一個新的指令，把問題完全改了。結果不再是查某個使用者，而是讓資料庫把所有使用者資料全部洩漏出來。」*

儘管這些弱點大家都很熟悉，但它們仍然是網路上被濫用最頻繁的漏洞之一。
防範方法包括：消毒輸入、固定格式，以及使用 PreparedStatement。


## XSS（跨站腳本攻擊）

「XSS 最好理解為一種客戶端注入弱點——攻擊者注入的惡意腳本會在使用者的瀏覽器中執行，而不是在伺服器端。」

簡單來說：XSS 讓攻擊者能劫持瀏覽器，而非伺服器，並竊取像是 cookies、會話資訊，甚至登入憑證。

### 🚨 為什麼 XSS 危險？

* 可**竊取會話**，冒充使用者
* 用於**釣魚攻擊**與**惡意軟體散播**
* 可以**修改整個頁面**——製造假登入表單、轉址用戶
* 常常**繞過 HTTPS 保護**，因為腳本是在瀏覽器執行

### 🔒 XSS 類型（選填，快速說明）

你不需要很深入，但在跟技術人員談話時知道這些名詞會有幫助：

1. **儲存型 XSS** – 惡意腳本永久儲存在伺服器（例如資料庫）
2. **反射型 XSS** – 腳本立即反射回來（例如 URL 中）
3. **基於 DOM 的 XSS** – 弱點在客戶端 JavaScript 中

---

# 弱點接露
google project zero

---

## 原罪

### 1.人一定會出錯
軟體是人寫的，只要是人就有可能出錯，不論多少教育訓練、採用什麼開發架構，也無法避免人為疏失。
從下面案例就可看出思科 [^1] IBM[^2] Chrome [^3] Apple IOS [^4] [^5] Adobe[^6] 微軟[^7]，即使是最頂尖人才組成的最頂尖企業，也無法避免出現弱點。

SQL注入 相對容易預防 卻還是很常見

### 2.光發現無法解決問題

實務上我們主要仰賴弱點懸賞、通報等，來試著枯竭現存的弱點。但弱點的發現辦法對解決弱點起到幫助。而且同類型的弱點找到出現在這處，不代表能存在其他處的同弱點都能被找到，也不代表未來寫的程式能避免這弱點。


### 3.補釘修補
零時差

原因在於，即便廠商釋出修補，但用戶不一定有修補，或是有些漏洞被揭露，但廠商可能因為產品生命週期結束等原因，而不願修補或尚未修補

還沒修補已知弱點

修補程式 逆向工程 發覺與弱點息息相關的線索
成為駭客尋找弱點的燈塔 入侵尚未補丁的裝置
修補星期二 漏洞利用星期三

修補程式發布 不願意更新
安裝後造成的問題 軟體相衝 修補程式造成電腦當季
微軟自己也沒準時安裝補丁"就跟整個產業一樣，都很難在修補程式上按應遵循的標準做到百分之百"
'We, like the rest of the industry, struggle to get 100 percent compliance with our patch management,''
On the other hand, their own actions demonstrate how unrealistic that position is.' [連結](https://www.nytimes.com/2003/01/28/business/technology-worm-hits-microsoft-which-ignored-own-advice.html)

### 4.操作空間與危險

C C++語言讓使用者控制，是優勢，也就會有出錯的空間
### Linux應對
ASLRR 位址空間配置隨機 Address Space Layout Randomization 之前一般都是位在記憶體空間頂部 ASLR隱藏堆疊
ASLR很快失效 駭客找到堆疊位址的方法
推出ESP 可執行空間保護 Executeable Space Protection 會將推疊所在的記憶體為指標是為不可執行 就算破解ASLR找到植入代碼 ESP也會拒絕執行
ESP 失效 Return Oriented Programming返回導向程式設計 不再將惡意軟體植入堆疊 而是尋找堆疊外可以協助完成任位的代碼片段
ROP中 每個片段結尾的指令 都是返回到堆疊 每個片段的記憶體位只放在堆疊上 串接再一起執行惡意程式 
片段跳轉到堆疊 堆疊跳轉到片段 控制程式流




[^1]: https://www.ithome.com.tw/news/170663
[^2]: https://www.ithome.com.tw/news/169768
[^3]: https://www.ithome.com.tw/news/171194
[^4]: https://www.ithome.com.tw/news/169558
[^5]: https://www.ithome.com.tw/news/170738
[^6]: https://www.ithome.com.tw/news/164977
[^7]: https://www.ithome.com.tw/news/171140